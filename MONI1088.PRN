	MACRO-80 3.44	09-Dec-81	PAGE	1


                                ; ************************************************************
                                ; *                                                          *
                                ; *  MONITOR 10/88 fuer den AC 1     Version vom 29.07.2022  *
                                ; *                                                          *
                                ; ************************************************************
                                ;
                                ; Aenderungen:
                                ;
                                ; MONI88 - Korrekturen an der Originalversion 1988: 
                                ; - Fuer die Nutzung der Grafiktaste wurde Adresse 02A9H 
                                ;   von FFH auf 21H geaendert
                                ; - korrekte V.24-Baudraten fuer den Betrieb mit 2 MHz
                                ;   (das bisherige Timing war fuer 2,4768 MHz ausgelegt)
                                ;   Korrekturen auf Adr. 00F9H bis 00FBH und 0E39H bis 0E3BH
                                ;
                                ; MONI88A - zus. Aenderungen an der Originalversion 1988:
                                ; - Backspace/DEL mit 7FH (Adr. 0323H)
                                ; - RAM loeschen mit Kommando "p" von 1858H bis 0FEFFH
                                ; - die Monitorkommandos "X", "b" und "r" wurden entfernt
                                ; - neues Monitorkommando "X": Start der AC1-2010 ROM-Bank
                                ;
                                ; MONI11 - Korrekturen an der BWS-CPLD-Version 2011:
                                ; - Fehler beim Monitorkommando "7" fuer die PIO2-Karte:
                                ;   Adresse 0FD4H von 10H auf 20H korrigiert
                                ;
                                ; MONI11A - zus. Aenderungen an der BWS-CPLD-Version 2011:
                                ; - Farbbyte 0F9FH ist 4FH (= weiss auf blauem Hintergrund)
                                ; - V.24-Kontrollregister (Adr. 023EH) wieder auf 02H
                                ; - die Monitorkommandos "X", "b" und "r" wurden entfernt
                                ; - neues Monitorkommando "X": Start der AC1-2010 ROM-Bank
                                ;
                                ;
                                ; ***************************************************
                                ; *  Wichtig: Hier muss die gewuenschte             *
                                ; *           Monitorversion auskommentiert werden  *
                                ; ***************************************************
  0001                          MONI88  EQU  1       ;Monitor 10/88 - Originalversion 1988
                                ;MONI88A EQU  1       ;Monitor 10/88 - Originalversion mit Anpassungen
                                ;MONI11  EQU  1       ;Monitor 10/88 - BWS-CPLD-Version 2011
                                ;MONI11A EQU  1       ;Monitor 10/88 - BWS-CPLD-Version mit Anpassungen
                                ;
                                ;
                                        PAGE 64
	MACRO-80 3.44	09-Dec-81	PAGE	1-1


                                
                                ;
                                        IF1
                                        IFDEF MONI88
                                        .PRINTX 'Monitor 10/88 - Originalversion 1988'
                                        ENDIF
                                        IFDEF MONI88A
                                        .PRINTX 'Monitor 10/88 - Originalversion mit Anpassungen'
                                        ENDIF
                                        IFDEF MONI11
                                        .PRINTX 'Monitor 10/88 - BWS-CPLD-Version 2011'
                                        ENDIF
                                        IFDEF MONI11A
                                        .PRINTX 'Monitor 10/88 - BWS-CPLD-Version mit Anpassungen'
                                        ENDIF
                                        .PRINTX 'PASS 1'
                                        ENDIF
                                ;
                                        IF2
                                        .PRINTX 'PASS 2'
                                        ENDIF
                                ;
                                        .CREF
                                        .Z80
                                ;
  007F                          KURSOR  EQU  7FH          ;Kursorsymbol
                                ;
  1800                          KURPOS  EQU  1800H        ;Zwischenspeicher Kursor
  181A                          ZWINL   EQU  181AH        ;Zwischenspeicher 'Inline'
  181F                          COLOR   EQU  181FH        ;Merkzelle fuer das Farbbyte im RAM
  1820                          V24REG  EQU  1820H        ;V.24-Kontrollregister
  1821                          IOBYTE  EQU  1821H        ;Merkzelle fuer das I/O-Byte
  1822                          TASCOD  EQU  1822H        ;Tastencode der zuletzt gedrC<ckten Taste
  1857                          HREGIN  EQU  1857H        ;Hilfsregister UP 'INLINE'
  185B                          ARG1    EQU  185BH        ;Zwischenspeicher Argument 1
  185D                          ARG2    EQU  185DH        ;Zwischenspeicher Argument 2
  185F                          ARG3    EQU  185FH        ;Zwischenspeicher Argument 3
                                ;
  0000                          P00     EQU  00H          ;CTC
  0004                          P04     EQU  04H          ;PIO 1 - Port A (Daten)
  0005                          P05     EQU  05H          ;PIO 1 - Port B (Daten)
  0008                          P08     EQU  08H          ;PIO 2 - Port A (Daten)
  000E                          P0E     EQU  0EH          ;ROM-Bank: EPROM-Einblendung
  000F                          P0F     EQU  0FH          ;PIO2-Karte: EPROM-Einblendung
  0014                          P14     EQU  14H          ;Modul 1: Konfigurationsregister
  0016                          P16     EQU  16H          ;RAM 0000H bis 0FFFH einblenden
  00F0                          PF0     EQU  0F0H         ;COLOR-BWS
                                ;
                                        .PHASE 0000H
                                ;
  0000    F3                    L0000:  DI 
  0001    31 1856                       LD   SP,1856H     ;Stack 
  0004    ED 5E                         IM   2 
  0006    18 03                         JR   INIT1 
                                ;
                                ;
                                ; RST 8H - Eingabekanal, normal Tastatur
                                ; --------------------------------------
                                ;
	MACRO-80 3.44	09-Dec-81	PAGE	1-2


  0008    C3 1802               L0008:  JP   1802H        ;Sprungtabelle 1802H
                                ;
                                ;
                                ; INIT1 nach Reset
                                ;
  000B    CD 011D               INIT1:  CALL MS30         ;Zeitschleife 30ms
  000E    18 0B                         JR   INIT2 
                                ;
                                ;
                                ; RST 10H - Ausgabekanal, normal Bildschirm
                                ; -----------------------------------------
                                ;
  0010    C3 1805               L0010:  JP   1805H        ;Sprungtabelle 1805H
                                ;
                                ;
                                ; Einsprungpunkt fuer RST 10H   (Ausgabekanal, normal Bildschirm)
                                ; ---------------------------
                                ;
  0013    E5                    RST10:  PUSH HL 
  0014    F5                            PUSH AF 
  0015    C3 0EF2                       JP   RST10A 
                                ;
                                ;
                                ; RST 18H - Zeichenkettenausgabe bis incl. des Bytes, wo Bit 7 gesetzt ist
                                ; ------------------------------------------------------------------------
                                ;
  0018    C3 1808               L0018:  JP   1808H        ;Sprungtabelle 1808H
                                ;
                                ;
                                ; Init2 nach Reset
                                ;
  001B    11 1800               INIT2:  LD   DE,KURPOS
  001E    18 1B                         JR   INIT3 
                                ;
                                ;
                                ; RST 20H - nicht verwendet
                                ; -------------------------
                                ;
  0020    C3 180B               L0020:  JP   180BH        ;Sprungtabelle 180BH
                                ;
                                ;
                                        IFDEF MONI88      ;Monitor 10/88 - Originalversion 1988
  0023                                  DEFS 5,0FFH       ;Platzhalter 5 Byte
                                        ENDIF
                                        IFDEF MONI88A     ;Monitor 10/88 - Originalversion mit Anpassungen
                                        DEFS 5,0FFH       ;Platzhalter 5 Byte
                                        ENDIF
                                        IFDEF MONI11      ;Monitor 10/88 - BWS-CPLD-Version 2011
                                ;
                                ; Codeschnipsel zur Funktion "8"
                                ; ------------------------------
                                ;
                                FKT8:   LD   A,40H        ;Codeschnipsel zur Funktion "8"
                                        JP   FKT0         ;A auf Port 0FH ausgeben
                                ;
                                        ENDIF
                                        IFDEF MONI11A     ;Monitor 10/88 - BWS-CPLD-Version mit Anpassungen
                                ;
                                ; Codeschnipsel zur Funktion "8"
                                ; ------------------------------
	MACRO-80 3.44	09-Dec-81	PAGE	1-3


                                ;
                                FKT8:   LD   A,40H        ;Codeschnipsel zur Funktion "8"
                                        JP   FKT0         ;A auf Port 0FH ausgeben
                                ;
                                        ENDIF
                                ;
                                ;
                                ; RST 28H - nicht verwendet
                                ; -------------------------
                                ;
  0028    C3 180E               L0028:  JP   180EH        ;Sprungtabelle 180EH
                                ;
                                ;
                                ; Funktion Ausgabe ueber Bildschirm - Teil 2
                                ; ------------------------------------------
                                ;
  002B    E5                    FKT33A: PUSH HL 
  002C    D5                            PUSH DE 
  002D    C3 0300                       JP   FKT33B 
                                ;
                                ;
                                ; RST 30H - nicht verwendet
                                ; -------------------------
                                ;
  0030    C3 1811               L0030:  JP   1811H        ;Sprungtabelle 1811H
                                ;
                                ;
                                ; Funktion auf Adresse 0033H - Ausgabe ueber Bildschirm
                                ; -----------------------------------------------------
                                ;
  0033    F5                    FKT33:  PUSH AF 
  0034    18 F5                         JR   FKT33A 
                                ;
  0036                                  DEFS 2,0FFH       ;Platzhalter 2 Byte
                                ;
                                ; RST 38H - Breakpoint
                                ; --------------------
                                ;
  0038    C3 1814                       JP   1814H        ;Sprungtabelle 1814H
                                ;
                                ;
                                ; INIT3 nach Reset
                                ;
  003B    3E 02                 INIT3:  LD   A,02H        ;HWT vom Interruptvektor
  003D    ED 47                         LD   I,A 
  003F    21 0AD8                       LD   HL,TABIO     ;Tabelle fuer IO-Befehle
  0042    06 11                         LD   B,11H        ;insgesamt 17 Befehle an versch. Ports
  0044    4E                    INIT4:  LD   C,(HL) 
  0045    23                            INC  HL 
  0046    ED A3                         OUTI 
  0048    20 FA                         JR   NZ,INIT4 
  004A    EB                            EX   DE,HL 
  004B    06 60                         LD   B,60H        ;1800H bis 185FH mit 0FFH beschreiben
  004D    36 FF                 INIT5:  LD   (HL),0FFH    ;HL=1800H
  004F    23                            INC  HL 
  0050    10 FB                         DJNZ INIT5 
  0052    01 0020                       LD   BC,0020H     ;Laenge = 32 Bytes
  0055    21 0220                       LD   HL,SPTAB     ;Sprungtabelle = 0220H
  0058    11 1802                       LD   DE,1802H     ;Ziel = 1802H
  005B    ED B0                         LDIR 
	MACRO-80 3.44	09-Dec-81	PAGE	1-4


                                        IFDEF MONI88      ;Monitor 10/88 - Originalversion 1988
  005D    CD 0297                       CALL UPTAST       ;Taste gedrueckt?
                                        ENDIF
                                        IFDEF MONI88A     ;Monitor 10/88 - Originalversion mit Anpassungen
                                        CALL UPTAST       ;Taste gedrueckt?
                                        ENDIF
                                        IFDEF MONI11      ;Monitor 10/88 - BWS-CPLD-Version 2011
                                        CALL FARBIN       ;CALL Farb-Initialisierung
                                        ENDIF
                                        IFDEF MONI11A     ;Monitor 10/88 - BWS-CPLD-Version mit Anpassungen
                                        CALL FARBIN       ;CALL Farb-Initialisierung
                                        ENDIF
  0060    20 07                         JR   NZ,INIT6     ;Taste gedrueckt (nur Originalversion 1988)
  0062    18 0A                         JR   INIT7 
                                ;
  0064                                  DEFS 2,0FFH       ;Platzhalter 2 Byte
                                ;
                                ; NMI-Befehl, Programmunterbrechung
                                ; ---------------------------------
                                ;
  0066    C3 1817                       JP   1817H        ;Sprungtabelle 1817H
                                ;
                                ;
  0069    FE 58                 INIT6:  CP   58H          ;Taste "X" gedrueckt?
  006B    CA 0116               JUMPX:  JP   Z,PROGX      ;Sprung zum Programmpaket X
  006E    AF                    INIT7:  XOR  A 
  006F    D3 14                         OUT  (P14),A      ;Modul 1: zuruecksetzen
  0071    DF                            RST  18H 
  0072    0C 0D 0F 0F                   DEFB 0CH,0DH,0FH,0FH 
                                        IFDEF MONI88      ;Monitor 10/88 - Originalversion 1988
  0076    41 43 20 31                   DEFM "AC 1 * MONITOR *" 
  007A    20 2A 20 4D           
  007E    4F 4E 49 54           
  0082    4F 52 20 2A           
  0086    20 55 38 38                   DEFM " U880  * (10/88)" 
  008A    30 20 20 2A           
  008E    20 28 31 30           
  0092    2F 38 38 29           
                                        ENDIF
                                        IFDEF MONI88A     ;Monitor 10/88 - Originalversion mit Anpassungen
                                        DEFM "AC 1 * MONITOR *" 
                                        DEFM " U880  * (10/88)" 
                                        ENDIF
                                        IFDEF MONI11      ;Monitor 10/88 - BWS-CPLD-Version 2011
                                        DEFM "AC 1 * MONITOR (" 
                                        DEFM "10/88) * 11/2011" 
                                        ENDIF
                                        IFDEF MONI11A     ;Monitor 10/88 - BWS-CPLD-Version mit Anpassungen
                                        DEFM "AC 1 * MONITOR (" 
                                        DEFM "10/88) * 11/2011" 
                                        ENDIF
  0096    0D 8D                         DEFB 0DH,0DH+80H 
  0098    C3 025B                       JP   GETCO        ;Sprung in die Monitoreingabeschleife
                                ;
                                ;
                                ; Tasten-Piep
                                ;
  009B    71                    PIEP:   LD   (HL),C 
  009C    01 A034                       LD   BC,0A034H
  009F    CD 0287                       CALL UPTON        ;UP 'Ton', Reg, B = Tonlaenge, C = Tonhoehe
	MACRO-80 3.44	09-Dec-81	PAGE	1-5


  00A2    C1                    ENDE8:  POP  BC 
  00A3    E1                            POP  HL 
  00A4    C9                            RET 
                                ;
                                ;
                                ; Einsprungpunkt fuer RST 08H   (Eingabekanal, normal Tastatur)
                                ; ---------------------------
                                ;
  00A5    E5                    RST08:  PUSH HL 
  00A6    C5                            PUSH BC 
  00A7    3A 1821                       LD   A,(IOBYTE)   ;LD A,I/O-Byte 
  00AA    0F                            RRCA              ;Rotiere A-Register rechts
  00AB    30 29                         JR   NC,NOTAST    ;anderes Eingabegeraet (keine Tastatur)
  00AD    21 1857                       LD   HL,HREGIN    ;Hilfsregister UP 'INLINE'
  00B0    46                            LD   B,(HL) 
  00B1    36 18                         LD   (HL),18H 
  00B3    CD 0297               RST08A: CALL UPTAST       ;Taste gedrueckt?
  00B6    28 05                         JR   Z,RST08B     ;nein
  00B8    05                            DEC  B            ;ja
  00B9    20 F8                         JR   NZ,RST08A    ;Zeitschleife, Entprellung
  00BB    36 01                         LD   (HL),01H 
  00BD    2A 1800               RST08B: LD   HL,(KURPOS) 
  00C0    4E                            LD   C,(HL)       ;bisherigen BS-Wert in C merken
  00C1    36 7F                 RST08C: LD   (HL),KURSOR  ;Kursorsymbol = 7FH setzen
  00C3    CD 0297               RST08D: CALL UPTAST       ;Taste gedrueckt?
  00C6    20 D3                         JR   NZ,PIEP      ;ja --> Tasten-Piep --> und RET
  00C8    3E 48                         LD   A,48H 
  00CA    3D                    RST08E: DEC  A 
  00CB    20 FD                         JR   NZ,RST08E    ;Zeitschleife A
  00CD    10 F4                         DJNZ RST08D       ;Zeitschleife B
  00CF    79                            LD   A,C          ;bisheriger BS-Wert nach A
  00D0    BE                            CP   (HL) 
  00D1    28 EE                         JR   Z,RST08C     ;Kursor setzen
  00D3    71                            LD   (HL),C 
  00D4    18 ED                         JR   RST08D       ;bisherigen BS-Wert setzen
                                ;
  00D6    0F                    NOTAST: RRCA              ;Rotiere A-Register rechts
  00D7    30 33                         JR   NC,NOV24     ;anderes Eingabegeraet (kein V.24)
                                ;
                                ;
                                ; Eingabegeraet = V.24
                                ; --------------------
                                ;
  00D9    3A 1820               V24IN1: LD   A,(V24REG)   ;V.24-Kontrollregister
  00DC    E6 07                         AND  07H          ;Selektion der Baudrate
  00DE    47                            LD   B,A          ;B = Baudrate (kodiert)
  00DF    3E 01                         LD   A,01H 
  00E1    87                    V24IN2: ADD  A,A 
  00E2    10 FD                         DJNZ V24IN2 
  00E4    67                            LD   H,A          ;19200 Baud --> H = 2
  00E5    AF                            XOR  A 
  00E6    D3 08                         OUT  (P08),A      ;Steuerleitung auf Low setzen
  00E8    DB 08                 V24IN3: IN   A,(P08)      ;Daten lesen PIO2, Port A
  00EA    E6 01                         AND  01H          ;BIT 0 auswerten (RxD)
  00EC    20 FA                         JR   NZ,V24IN3    ;warten auf fallende Flanke
  00EE    44                            LD   B,H
  00EF    ED 5F                 V24IN4: LD   A,R          ;Zeitschleife bis zur Bit-Abtastung
  00F1    7F                            LD   A,A
  00F2    10 FB                         DJNZ V24IN4
  00F4    06 0A                         LD   B,10         ;10 Durchlaeufe Bit-Abtastung
	MACRO-80 3.44	09-Dec-81	PAGE	1-6


  00F6    6C                    V24IN5: LD   L,H 
  00F7    CB 19                         RR   C            ;C rechts rotieren durch CY
  00F9    6E                    V24IN6: LD   L,(HL)       ;Baudratenanpassung fuer 2 MHz
  00FA    DD 23                         INC  IX           ;Baudratenanpassung fuer 2 MHz
  00FC    2D                            DEC  L 
  00FD    DB 08                         IN   A,(P08)      ;Daten lesen PIO2, Port A
  00FF    20 F8                         JR   NZ,V24IN6    ;warten auf fallende Flanke
  0101    1F                            RRA               ;empfangenes Bit 0 --> CY
  0102    10 F2                         DJNZ V24IN5 
  0104    3E 0A                         LD   A,0AH
  0106    D3 08                         OUT  (P08),A      ;Steuerleitung auf High setzen
  0108    79                            LD   A,C          ;empfangenes Zeichen --> A
  0109    18 97                         JR   ENDE8        ;Ende von RST08
                                ;
  010B    FF                            DEFB 0FFH         ;Platzhalter 1 Byte
                                ;
                                ; anderes Eingabegeraet (keine Tastatur, kein V.24)
                                ;
  010C    0F                    NOV24:  RRCA              ;Rotiere A-Register rechts
  010D    DC FFFF                       CALL C,0FFFFH     ;Reserve --> nicht belegt --> Fehlermeldung
  0110    0F                            RRCA              ;Rotiere A-Register rechts
  0111    DC 18F0                       CALL C,18F0H      ;Sprung zum UP User-Eingabe
  0114    18 8C                         JR   ENDE8        ;Ende von RST08
                                ;
                                ;
                                ; Start vom Programmpaket X
                                ; -------------------------
                                ;
                                        IFDEF MONI88      ;Monitor 10/88 - Originalversion 1988
  0116    3E 01                 PROGX:  LD   A,01H 
  0118    D3 14                         OUT  (P14),A      ;Modul 1: EPROM mit Programmpaket X
  011A    C3 E000                       JP   0E000H       ;Sprung zum Programmpaket X
                                        ENDIF
                                        IFDEF MONI88A     ;Monitor 10/88 - Originalversion mit Anpassungen
                                PROGX:  JP   PROGX1       ;Sprung zur AC1 ROM-Bank
                                        DEFS 4,0FFH       ;Platzhalter 4 Byte
                                        ENDIF
                                        IFDEF MONI11      ;Monitor 10/88 - BWS-CPLD-Version 2011
                                PROGX:  LD   A,01H 
                                        OUT  (P14),A      ;Modul 1: EPROM mit Programmpaket X
                                        JP   0E000H       ;Sprung zum Programmpaket X
                                        ENDIF
                                        IFDEF MONI11A     ;Monitor 10/88 - BWS-CPLD-Version mit Anpassungen
                                PROGX:  JP   PROGX4       ;Sprung zur AC1-2010 ROM-Bank
                                        DEFS 4,0FFH       ;Platzhalter 4 Byte
                                        ENDIF
                                ;
                                ;
                                ; UP 'MS 30', Zeitschleife 30 ms
                                ; ------------------------------
                                ;
                                ; 26 Takte * 2307 Durchlaeufe = 59982 Takte --> 30 ms
                                ;
  011D    C5                    MS30:   PUSH BC 
  011E    01 0903                       LD   BC,0903H     ;Zeitkonstante fuer 30ms
  0121    0B                    MS30A:  DEC  BC           ;6 Takte
  0122    78                            LD   A,B          ;4 Takte
  0123    B1                            OR   C            ;4 Takte
  0124    20 FB                         JR   NZ,MS30A     ;12 Takte 
  0126    C1                            POP  BC 
	MACRO-80 3.44	09-Dec-81	PAGE	1-7


  0127    C9                            RET 
                                ;
                                ;
                                ; INLINE:
                                ; liest eine Zeile, die mit CR abgeschlossen wird, auf dem Schirm
                                ; ein und legt die RAM-Adresse vom Anfang der Zeile in den Zellen 
                                ; 181A und 181B ab
                                ; ---------------------------------------------------------------
                                ;
  0128    F5                    INLINE: PUSH AF 
  0129    E5                            PUSH HL 
  012A    DF                            RST  18H 
  012B    20 23                         DEFM " #"         ;Prompt ausgeben
  012D    A0                            DEFB 20H+80H 
  012E    00                            NOP 
  012F    CF                    INLIN1: RST  08H          ;1 Zeichen lesen
  0130    2A 1800                       LD   HL,(KURPOS)  ;Kursorposition merken
  0133    D7                            RST  10H          ;1 Zeichen ausgeben
  0134    FE 0D                         CP   0DH 
  0136    20 F7                         JR   NZ,INLIN1    ;Wiederholung, bis CR gedrueckt wurde
  0138    3E 23                         LD   A,23H        ;"#"
  013A    23                    INLIN2: INC  HL           ;1 Kursorposition zurueck
  013B    BE                            CP   (HL)         ;sind wir beim Prompt angekommen?
  013C    20 FC                         JR   NZ,INLIN2    ;nein
  013E    2B                            DEC  HL 
  013F    2B                            DEC  HL           ;jetzt 2 Kursorpositionen nach vorn
  0140    22 181A                       LD   (ZWINL),HL   ;Bildschirm-Adresse speichern
  0143    E1                            POP  HL 
  0144    F1                            POP  AF 
  0145    C9                            RET 
                                ;
                                ;
                                ; UP-Routine zu INHEX
                                ; -------------------
                                ;
  0146    1A                    UPINHX: LD   A,(DE) 
  0147    FE 20                         CP   20H          ;Leerzeichen am Anfang ignorieren
  0149    1B                            DEC  DE 
  014A    28 FA                         JR   Z,UPINHX 
  014C    13                            INC  DE 
  014D    AF                            XOR  A 
  014E    21 1858                       LD   HL,1858H     ;Zwischenspeicher initialisieren
  0151    77                            LD   (HL),A 
  0152    23                            INC  HL 
  0153    77                            LD   (HL),A 
  0154    23                            INC  HL 
  0155    77                            LD   (HL),A 
  0156    1A                    UPINH1: LD   A,(DE)       ;ASCII-Zahl lesen
  0157    2B                            DEC  HL 
  0158    2B                            DEC  HL           ;HL = 1858H
  0159    D6 30                         SUB  30H          ;ASCII --> BIN
  015B    F8                            RET  M            ;...wenn Ergebnis negativ ist
  015C    FE 0A                         CP   0AH          ;A > "9" ?
  015E    38 08                         JR   C,UPINH2     ;nein
  0160    D6 07                         SUB  07H          ;41H - 30H - 07H = 0AH Bingo. 
  0162    FE 0A                         CP   0AH          ;A < "A" ?
  0164    F8                            RET  M 
  0165    FE 10                         CP   10H          ;A > "F" ?
  0167    F0                            RET  P 
  0168    1B                    UPINH2: DEC  DE           ;DE --> naechste Ziffer
	MACRO-80 3.44	09-Dec-81	PAGE	1-8


  0169    34                            INC  (HL)         ;(1858H) += 1
  016A    23                            INC  HL 
  016B    ED 6F                         RLD               ;Rotiere Ziffer links zw. A und (HL)
  016D    23                            INC  HL 
  016E    ED 6F                         RLD               ;Rotiere Ziffer links zw. A und (HL)
  0170    18 E4                         JR   UPINH1 
                                ;
                                ;
                                ; UP INHEX
                                ; --------
                                ;
                                ;Wandelt eine maximal vierstellige in ASCII-Zeichen angegebene
                                ;Zahl ab (DE) abwaerts in deren hexadezimalen Wert um, der dann
                                ;in HL steht. DE wird entsprechend dekrementiert.
                                ;
  0172    C5                    INHEX:  PUSH BC 
  0173    F5                            PUSH AF 
  0174    CD 0146                       CALL UPINHX       ;Umwandlung ASCII --> HEX
  0177    23                            INC  HL           ;HL = 1859H
  0178    44                            LD   B,H 
  0179    4D                            LD   C,L          ;BC = HL
  017A    6E                            LD   L,(HL)       ;NWT --> L
  017B    03                            INC  BC
  017C    0A                            LD   A,(BC)
  017D    67                            LD   H,A          ;HWT --> H
  017E    C1                            POP  BC           ;AF zurueckholen nach BC
  017F    B5                            OR   L            ;Flags setzen (HL = 0?)
  0180    78                            LD   A,B          ;Akku auf alten Wert setzen
  0181    C1                            POP  BC           ;BC zurueckholen
  0182    C9                            RET 
                                ;
                                ;
                                ; UP OUTHEX
                                ; gibt den Akku als zweistellige Hexzahl auf dem Schirm aus
                                ; ---------------------------------------------------------
                                ;
  0183    F5                    OUTHEX: PUSH AF 
  0184    1F                            RRA               ;Rechtsrotation von A durch CY
  0185    1F                            RRA 
  0186    1F                            RRA 
  0187    1F                            RRA 
  0188    CD 018C                       CALL OUTHX1       ;HWT ausgeben
  018B    F1                            POP  AF 
  018C    F5                    OUTHX1: PUSH AF           ;im 2. Durchlauf NWT ausgeben
  018D    E6 0F                         AND  0FH 
  018F    C6 30                         ADD  A,30H 
  0191    FE 3A                         CP   3AH          ;A = (0..9)?
  0193    38 02                         JR   C,OUTHX2 
  0195    C6 07                         ADD  A,07H        ;A = (A..F)
  0197    D7                    OUTHX2: RST  10H 
  0198    F1                            POP  AF 
  0199    C9                            RET 
                                ;
                                ;
                                ; UP OUTHL
                                ; gibt das HL-Register als vierstellige Hexzahl auf dem Schirm aus
                                ; ----------------------------------------------------------------
                                ;
  019A    F5                    OUTHL:  PUSH AF 
  019B    7C                            LD   A,H 
	MACRO-80 3.44	09-Dec-81	PAGE	1-9


  019C    CD 0183                       CALL OUTHEX       ;H ausgeben
  019F    7D                            LD   A,L 
  01A0    CD 0183                       CALL OUTHEX       ;L ausgeben
  01A3    F1                            POP  AF 
  01A4    C9                            RET 
                                ;
                                ;
                                ; UP, CPU-Register ausraeumen nach RSA
                                ; ------------------------------------
                                ;
  01A5    ED 73 1858            CPURSA: LD   (1858H),SP   ;Stack merken
  01A9    31 1875                       LD   SP,1875H     ;Stack auf das Ende der RSA setzen
  01AC    FD E5                         PUSH IY 
  01AE    DD E5                         PUSH IX 
  01B0    E5                            PUSH HL 
  01B1    D5                            PUSH DE 
  01B2    C5                            PUSH BC 
  01B3    F5                            PUSH AF 
  01B4    D9                            EXX 
  01B5    08                            EX   AF,AF' 
  01B6    E5                            PUSH HL 
  01B7    D5                            PUSH DE 
  01B8    C5                            PUSH BC 
  01B9    F5                            PUSH AF 
  01BA    18 15                         JR   RSACP1       ;alten Stack zurueck und Tschuess
                                ;
                                ;
                                ; UP, CPU-Register einraeumen von RSA
                                ; -----------------------------------
                                ;
  01BC    ED 73 1858            RSACPU: LD   (1858H),SP   ;Stack merken
  01C0    31 1861                       LD   SP,1861H     ;Stack auf den Anfang der RSA setzen
  01C3    F1                            POP  AF 
  01C4    C1                            POP  BC 
  01C5    D1                            POP  DE 
  01C6    E1                            POP  HL 
  01C7    D9                            EXX 
  01C8    08                            EX   AF,AF' 
  01C9    F1                            POP  AF 
  01CA    C1                            POP  BC 
  01CB    D1                            POP  DE 
  01CC    E1                            POP  HL 
  01CD    DD E1                         POP  IX 
  01CF    FD E1                         POP  IY 
  01D1    ED 7B 1858            RSACP1: LD   SP,(1858H)   ;alten Stack zurueck
  01D5    C9                            RET 
                                ;
                                ;
                                ; V.24 - Eingabe UP
                                ; -----------------
                                ;
  01D6    E5                    V24IN:  PUSH HL
  01D7    C5                            PUSH BC 
  01D8    C3 00D9                       JP   V24IN1 
                                ;
                                ;
                                ; kein gueltiges Zeichen bei der Kommandozeicheneingabe
                                ; -----------------------------------------------------
                                ;
  01DB    DF                    KOMM0:  RST  18H 
	MACRO-80 3.44	09-Dec-81	PAGE	1-10


  01DC    20                            DEFM " " 
  01DD    BF                            DEFB 3FH+80H      ;"?+80H 
                                ;
                                ;
                                ; Warteschleife Kommandozeicheneingabe
                                ; ------------------------------------
                                ;
  01DE    CD 0128               KOMM1:  CALL INLINE       ;Kommandozeile lesen (Adresse 01DEH)
  01E1    21 0200                       LD   HL,0200H     ;Anfangsadresse fuer Suchbereich
  01E4    01 FE00                       LD   BC,0FE00H    ;Laenge des Suchbereiches
  01E7    AF                    KOMM2:  XOR  A            ;1. Such-Byte = 00H
  01E8    ED B1                         CPIR 
  01EA    E2 01DB                       JP   PO,KOMM0     ;BC=0 --> nichts gefunden, nochmal
  01ED    3E 09                         LD   A,09H        ;2. Such-Byte = 09H
  01EF    BE                            CP   (HL) 
  01F0    20 F5                         JR   NZ,KOMM2 
  01F2    23                            INC  HL 
  01F3    ED 5B 181A                    LD   DE,(ZWINL)   ;3. Such-Byte = aus Kommandozeile
  01F7    1A                            LD   A,(DE) 
  01F8    BE                            CP   (HL) 
  01F9    20 EC                         JR   NZ,KOMM2 
  01FB    23                            INC  HL 
  01FC    3E 0D                         LD   A,0DH        ;4. Such-Byte = 0DH
  01FE    BE                            CP   (HL) 
  01FF    20 E6                         JR   NZ,KOMM2 
  0201    01 01DE                       LD   BC,01DEH     ;Adresse Kommandozeicheneingabe
  0204    C5                            PUSH BC           ;als Ruecksprung bei RET+RET
  0205    23                            INC  HL           ;Startadresse vom gefundenen Kommando
  0206    E5                            PUSH HL           ;als Ruecksprung bei RET
  0207    1B                            DEC  DE           ;naechstes Zeichen in der Kommandozeile
  0208    CD 0172                       CALL INHEX 
  020B    1A                            LD   A,(DE) 
  020C    FE 3A                         CP   3AH          ;":" --> gespeicherte Argumente nehmen
  020E    28 0F                         JR   Z,KOMM3 
  0210    22 185B                       LD   (ARG1),HL    ;Argumente aus der Kommandozeile laden
  0213    CD 0172                       CALL INHEX 
  0216    22 185D                       LD   (ARG2),HL 
  0219    CD 0172                       CALL INHEX 
  021C    22 185F                       LD   (ARG3),HL 
  021F    C9                    KOMM3:  RET
                                ;
                                ;
                                ; Sprungverteiler fuer RST und NMI (insgesamt 32 Bytes)
                                ; --------------------------------
                                ;
                                ; wird beim Systemstart nach Adresse 1802H kopiert
                                ; 
  0220    C3 00A5               SPTAB:  JP   RST08        ;Einsprungpunkt fuer RST 08H
  0223    C3 0013                       JP   RST10        ;Einsprungpunkt fuer RST 10H 
  0226    C3 0A8D                       JP   RST18        ;Einsprungpunkt fuer RST 18H
  0229    C3 FFFF                       JP   0FFFFH       ;Einsprungpunkt fuer RST 20H 
  022C    C3 FFFF                       JP   0FFFFH       ;Einsprungpunkt fuer RST 28H 
  022F    C3 FFFF                       JP   0FFFFH       ;Einsprungpunkt fuer RST 30H 
  0232    C3 0240                       JP   BREAK        ;Einsprungpunkt fuer RST 38H 
  0235    C3 0240                       JP   BREAK        ;Einsprungpunkt fuer NMI 
  0238    FF FF                         DEFB 0FFH,0FFH    ;Zwischenspeicher 'Inline'
  023A    53 43 48                      DEFM "SCH"        ;Warmstartcode
                                        IFDEF MONI88      ;Monitor 10/88 - Originalversion 1988
  023D    AF                            DEFB 0AFH         ;Warmstartcode
  023E    02                            DEFB 02H          ;Kommando-Code V.24 (9600 Baud)
	MACRO-80 3.44	09-Dec-81	PAGE	1-11


                                        ENDIF
                                        IFDEF MONI88A     ;Monitor 10/88 - Originalversion mit Anpassungen
                                        DEFB 0AFH         ;Warmstartcode
                                        DEFB 02H          ;Kommando-Code V.24 (9600 Baud)
                                        ENDIF
                                        IFDEF MONI11      ;Monitor 10/88 - BWS-CPLD-Version 2011
                                        DEFB 00H          ;Warmstartcode
                                        DEFB 43H          ;Kommando-Code V.24 (4800 Baud)
                                        ENDIF
                                        IFDEF MONI11A     ;Monitor 10/88 - BWS-CPLD-Version mit Anpassungen
                                        DEFB 00H          ;Warmstartcode
                                        DEFB 02H          ;Kommando-Code V.24 (9600 Baud)
                                        ENDIF
  023F    11                            DEFB 11H          ;I/O-Byte (Adresse 1821H)
                                ;
                                ;
                                ; Einsprungpunkt fuer RST 38H und NMI
                                ; -----------------------------------
                                ;
  0240    CD 01A5               BREAK:  CALL CPURSA        ;UP, CPU-Register ausraeumen nach RSA
  0243    E1                            POP  HL
  0244    2B                            DEC  HL
  0245    22 1875                       LD   (1875H),HL 
  0248    ED 73 1877                    LD   (1877H),SP 
  024C    31 1856                       LD   SP,1856H     ;Stack 
  024F    3E 11                         LD   A,11H 
  0251    32 1821                       LD   (IOBYTE),A   ;LD I/O-Byte,A
  0254    DF                            RST  18H 
  0255    20 42 52 45                   DEFM " BREA" 
  0259    41                    
  025A    CB                            DEFB 4BH+80H      ;"K+80H 
                                ;
                                ;
                                ; Monitoreingabeschleife, der Monitorstack wird neu initialisiert
                                ; ----------------------
                                ;
  025B    31 1856               GETCO:  LD   SP,1856H     ;Stack 
  025E    3E DA                         LD   A,0DAH
  0260    D3 05                         OUT  (P05),A 
  0262    21 01DE                       LD   HL,01DEH     ;Adresse Kommandozeicheneingabe
  0265    E5                            PUSH HL 
  0266    ED 45                         RETN 
                                ;
                                ;
                                ; UP 'ERROR', schreibt Zeichenkette 'ERROR'
                                ; -----------------------------------------
                                ;
  0268    DF                    ERROR:  RST  18H 
  0269    20 20 45 52                   DEFM "  ERROR" 
  026D    52 4F 52              
  0270    A0                            DEFB 20H+80H 
  0271    C9                            RET 
                                ;
                                ;
                                ; UP 'akustisches Signal'
                                ; -----------------------
                                ;
  0272    C5                    TUELUE: PUSH BC 
  0273    06 02                         LD   B,02H 
  0275    C5                    TUELU1: PUSH BC 
	MACRO-80 3.44	09-Dec-81	PAGE	1-12


  0276    01 0040                       LD   BC,0040H 
  0279    CD 0287                       CALL UPTON        ;UP 'Ton', Reg, B = Tonlaenge, C = Tonhoehe
  027C    01 F032                       LD   BC,0F032H
  027F    CD 0287                       CALL UPTON        ;UP 'Ton', Reg, B = Tonlaenge, C = Tonhoehe
  0282    C1                            POP  BC 
  0283    10 F0                         DJNZ TUELU1 
  0285    C1                            POP  BC 
  0286    C9                            RET 
                                ;
                                ;
                                ; UP 'Ton', Reg, B = Tonlaenge, C = Tonhoehe
                                ; ------------------------------------------
                                ;
  0287    F5                    UPTON:  PUSH AF 
  0288    DB 05                 L0288:  IN   A,(P05) 
  028A    1F                            RRA 
  028B    3F                            CCF 
  028C    17                            RLA 
  028D    D3 05                         OUT  (P05),A 
  028F    79                            LD   A,C 
  0290    3D                    L0290:  DEC  A 
  0291    20 FD                         JR   NZ,L0290 
  0293    10 F3                         DJNZ L0288 
  0295    F1                            POP  AF 
  0296    C9                            RET 
                                ;
                                ;
                                ; UP 'Taste', testet Tastaturstatus
                                ; ---------------------------------
                                ; kehrt bei gedrC<ckter Taste nach 18 ms mit dem Code zum Akku zurC<ck, 
                                ; keine Taste --> RC<ckkehr mit gesetzten Z-Flag und A=0
                                ; Code steht auch in 1822H
                                ;
  0297    C5                    UPTAST: PUSH BC 
  0298    CD 02C3                       CALL UPTAS4       ;Tastatur abfragen
  029B    28 20                         JR   Z,UPTAS3     ;Taste nicht gedrueckt
  029D    06 0C                         LD   B,0CH 
  029F    4F                            LD   C,A          ;Tastencode in C
  02A0    CD 02C3               UPTAS1: CALL UPTAS4       ;Entprellung
  02A3    B9                            CP   C 
  02A4    20 17                         JR   NZ,UPTAS3    ;Taste nicht (mehr) gedrueckt
  02A6    10 F8                         DJNZ UPTAS1 
                                ;
                                ; Einbau der Grafiktaste (nur Originaltastatur)                   
                                ; ----------------------                                                                
                                ; Der einpolige rastende Schalter kommt an PIO 1/B2 und Masse.    
                                ; Von PIO 1/B2 einen R = 330 Ohm und LED VQA 13 nach 5P an-         
                                ; schliessen. Die LED leuchtet bei eingeschalteter Grafiktastatur.                          
                                ; Adresse 02A9 Datenbyte FF in 21 aendern. 
                                ;                        
  02A8    FE 21                         CP   21H          ;Grafiktaste wird verwendet
  02AA    38 0F                         JR   C,UPTAS2     ;keine Grafik, wenn Tastencode < 21H ist
  02AC    DB 05                         IN   A,(P05)      ;PIO1 Port B lesen
  02AE    CB 57                         BIT  2,A          ;Bit 2 = Grafiktaste
  02B0    79                            LD   A,C          ;Tastencode nach A
  02B1    20 08                         JR   NZ,UPTAS2    ;Grafiktaste nicht gedrueckt
  02B3    C6 80                         ADD  A,80H        ;7. Bit setzen
  02B5    FE E0                         CP   0E0H
  02B7    38 02                         JR   C,UPTAS2     ;Kleinbuchstaben gehen nicht
  02B9    D6 60                         SUB  60H          ;Grafik-Wertebereich = 41H...7FH
	MACRO-80 3.44	09-Dec-81	PAGE	1-13


  02BB    04                    UPTAS2: INC  B 
  02BC    06                            DEFB 06H          ;LD  B,0AFH (incl. naechsten Befehl!!!)
  02BD    AF                    UPTAS3: XOR  A            ;Einsprungpunkt "Taste nicht gedrueckt"
  02BE    C1                            POP  BC 
  02BF    32 1822                       LD   (TASCOD),A   ;Tastencode der zuletzt gedrueckten Taste
  02C2    C9                            RET 
                                ;
  02C3    3E 48                 UPTAS4: LD   A,48H        ;Zeitschleife
  02C5    3D                    UPTAS5: DEC  A 
  02C6    20 FD                         JR   NZ,UPTAS5 
  02C8    DB 04                         IN   A,(P04)      ;PIO1 Port A lesen
  02CA    CB 7F                         BIT  7,A          ;Taste gedrueckt?
  02CC    CB BF                         RES  7,A          ;7. Bit ruecksetzen
  02CE    C9                            RET 
                                ;
                                ;
                                ; Funktion "W" --> Port ausgeben
                                ;
  02CF    00 09 57 0D                   DEFB 00H,09H,57H,0DH 
  02D3    CD 04CA                       CALL ARGLD        ;ARG1-->HL ARG2-->DE ARG3-->BC 
  02D6    44                            LD   B,H          ;HL-->BC
  02D7    4D                            LD   C,L
  02D8    ED 59                         OUT  (C),E        ;OUT (C),r legt das komplette BC-Register
  02DA    C9                            RET               ;auf den Adressbus
                                ;
                                ;
                                        IFDEF MONI88      ;Monitor 10/88 - Originalversion 1988
  02DB                                  DEFS 21,0FFH      ;Platzhalter 21 Byte
                                        ENDIF
                                        IFDEF MONI88A     ;Monitor 10/88 - Originalversion mit Anpassungen
                                        DEFS 21,0FFH      ;Platzhalter 21 Byte
                                        ENDIF
                                        IFDEF MONI11      ;Monitor 10/88 - BWS-CPLD-Version 2011
                                ;
                                ; Codeschnipsel fuer Farb-Initialisierung
                                ;
                                FARBIN: CALL FINIT        ;Farb-Initialisierung 
                                        JR   UPTAST       ;Taste gedrueckt?
                                ;
                                ;
                                ; Funktion "6" --> PIO2-Karte: Bank 1 einschalten
                                ;
                                        DEFB 00H,09H,36H,0DH 
                                        LD   A,10H 
                                        JR   FKT0         ;A auf Port 0FH ausgeben
                                ;
                                ;
                                ; Funktion "0" --> PIO2-Karte: EPROM ausblenden
                                ;
                                        DEFB 00H,09H,30H,0DH 
                                        XOR  A
                                FKT0:   OUT  (P0F),A 
                                        RET 
                                ;
                                        ENDIF
                                        IFDEF MONI11A     ;Monitor 10/88 - BWS-CPLD-Version mit Anpassungen
                                ;
                                ; Codeschnipsel fuer Farb-Initialisierung
                                ;
                                FARBIN: CALL FINIT        ;Farb-Initialisierung 
	MACRO-80 3.44	09-Dec-81	PAGE	1-14


                                        JR   UPTAST       ;Taste gedrueckt?
                                ;
                                ;
                                ; Funktion "6" --> PIO2-Karte: Bank 1 einschalten
                                ;
                                        DEFB 00H,09H,36H,0DH 
                                        LD   A,10H 
                                        JR   FKT0         ;A auf Port 0FH ausgeben
                                ;
                                ;
                                ; Funktion "0" --> PIO2-Karte: EPROM ausblenden
                                ;
                                        DEFB 00H,09H,30H,0DH 
                                        XOR  A
                                FKT0:   OUT  (P0F),A 
                                        RET 
                                ;
                                        ENDIF
                                ;
                                ;
                                ; Zeichensatz SCCH <--> ACC umschalten
                                ;
  02F0    DB 05                 ZGUMS:  IN   A,(P05)
  02F2    EE 08                         XOR  08H 
  02F4    D3 05                         OUT  (P05),A 
  02F6    18 36                         JR   BSEND3 
                                ;
                                ;
                                        IFDEF MONI88      ;Monitor 10/88 - Originalversion 1988
  02F8    5B 07                         DEFB 5BH,07H      ;Interruptvektor CTC --> 075BH ???
  02FA                                  DEFS 6,0FFH       ;Platzhalter 6 Byte
                                        ENDIF
                                        IFDEF MONI88A     ;Monitor 10/88 - Originalversion mit Anpassungen
                                        DEFB 5BH,07H      ;Interruptvektor CTC --> 075BH ???
                                        DEFS 6,0FFH       ;Platzhalter 6 Byte
                                        ENDIF
                                        IFDEF MONI11      ;Monitor 10/88 - BWS-CPLD-Version 2011
                                ;
                                        DEFB 5BH,5BH      ;Interruptvektor CTC --> 5B5BH ???
                                ;
                                ;
                                ; RAM von 0000H bis 0FFFH einschalten
                                ;
                                ALTMO:  LD   (0FFFEH),HL  ;wird von Fkt. "Y" angesprungen
                                        JP   0FFFEH       ;Start alternativer Monitor im RAM
                                ;
                                        ENDIF
                                        IFDEF MONI11A     ;Monitor 10/88 - BWS-CPLD-Version mit Anpassungen
                                ;
                                        DEFB 5BH,5BH      ;Interruptvektor CTC --> 5B5BH ???
                                ;
                                ;
                                ; RAM von 0000H bis 0FFFH einschalten
                                ;
                                ALTMO:  LD   (0FFFEH),HL  ;wird von Fkt. "Y" angesprungen
                                        JP   0FFFEH       ;Start alternativer Monitor im RAM 
                                ;
                                        ENDIF
                                ;
                                ;
	MACRO-80 3.44	09-Dec-81	PAGE	1-15


                                ; Funktion Ausgabe ueber Bildschirm - Teil 3
                                ; ------------------------------------------
                                ;
  0300    C5                    FKT33B: PUSH BC 
  0301    ED 5B 1800                    LD   DE,(KURPOS)  ;Kursorposition auf dem BS
  0305    21 1856                       LD   HL,1856H     ;Stack
  0308    FE 10                         CP   10H          ;ist es ein BS-Steuerzeichen 00H...0FH?
  030A    30 0C                         JR   NC,FKT33C    ;nein
  030C    36 01                         LD   (HL),01H     ;ja --> Merker in 1856H setzen
  030E    01 03C7                       LD   BC,03C7H     ;Adresse vom Sprungverteiler fuer BS-Befehle
  0311    81                            ADD  A,C          ;Wertebereich von A = 00H...0FH
  0312    4F                            LD   C,A 
  0313    0A                            LD   A,(BC)       ;NWT der Einsprungadresse holen, HWT = 03H
  0314    4F                            LD   C,A 
  0315    C5                            PUSH BC           ;Einsprungadresse in den Stack
  0316    EB                            EX   DE,HL        ;Kursorposition in HL, Stack in DE
  0317    C9                            RET               ;zur Einsprungadresse springen
                                ;
  0318    35                    FKT33C: DEC  (HL)         ;muessen noch Argumente uebergeben werden?
  0319    20 18                         JR   NZ,KUPOSI    ;ja (fuer Kursorpositionierung mit Kommando 0EH)
  031B    36 01                 FKT33D: LD   (HL),01H     ;nein
  031D    EB                            EX   DE,HL        ;Kursorposition in HL, Stack in DE
  031E    FE 1A                         CP   1AH          ;^Z = Zeichensatz umschalten
  0320    28 CE                         JR   Z,ZGUMS 
                                        IFDEF MONI88      ;Monitor 10/88 - Originalversion 1988
  0322    FE 5F                         CP   5FH          ;Backspace/DEL mit 5FH
                                        ENDIF
                                        IFDEF MONI88A     ;Monitor 10/88 - Originalversion mit Anpassungen
                                        CP   7FH          ;Backspace/DEL mit 7FH
                                        ENDIF
                                        IFDEF MONI11      ;Monitor 10/88 - BWS-CPLD-Version 2011
                                        CP   7FH          ;Backspace/DEL mit 7FH
                                        ENDIF
                                        IFDEF MONI11A     ;Monitor 10/88 - BWS-CPLD-Version mit Anpassungen
                                        CP   7FH          ;Backspace/DEL mit 7FH
                                        ENDIF
  0324    28 37                         JR   Z,DELETE 
  0326    77                            LD   (HL),A       ;lade Zeichen auf Kursorposition
                                ;
                                ; 09H --> Kursor nach rechts
                                ;
  0327    2B                    BS0327: DEC  HL           ;Kursorposition--
  0328    CD 03DC               BSEND1: CALL SCROLL       ;muss der BS gescrollt werden?
  032B    22 1800               BSEND2: LD   (KURPOS),HL  ;Kursorposition in Kursorspeicher
  032E    C1                    BSEND3: POP  BC 
  032F    D1                            POP  DE 
  0330    E1                            POP  HL 
  0331    F1                            POP  AF 
  0332    C9                            RET 
                                ;
                                ; Auswertung der Argumente fuer die Kursorpositionierung
                                ; 1. Argument = BS-Zeile - Zehner
                                ; 2. Argument = BS-Zeile - Einer
                                ; 3. Argument = BS-Spalte - Zehner
                                ; 4. Argument = BS-Spalte - Einer
                                ;
  0333    FE 30                 KUPOSI: CP   30H          ;A < "0"?   A = "0"?
  0335    38 E4                         JR   C,FKT33D     ;kein gueltiges Argument
  0337    28 F5                         JR   Z,BSEND3     ;bei "0" Funktion verlassen
  0339    FE 3A                         CP   3AH          ;A >= "9"?
	MACRO-80 3.44	09-Dec-81	PAGE	1-16


  033B    30 DE                         JR   NC,FKT33D    ;kein gueltiges Argument
  033D    D6 30                         SUB  30H          ;A = 01H...09H
  033F    46                            LD   B,(HL)       ;lfd. Nr. des Arguments 1...4
  0340    EB                            EX   DE,HL        ;Kursorposition in HL
  0341    11 FFFF                       LD   DE,0FFFFH    ;--> 1 Zeichen nach rechts
  0344    05                            DEC  B 
  0345    28 0D                         JR   Z,KUPOS1     ;4. Argument
  0347    1E F6                         LD   E,0F6H       ;--> 10 Zeichen nach rechts
  0349    05                            DEC  B 
  034A    28 08                         JR   Z,KUPOS1     ;3. Argument
  034C    1E C0                         LD   E,0C0H       ;--> 1 Zeile nach unten
  034E    05                            DEC  B 
  034F    28 03                         JR   Z,KUPOS1     ;2. Argument 
  0351    11 FD80                       LD   DE,0FD80H    ;--> 10 Zeilen nach unten
  0354    47                    KUPOS1: LD   B,A 
  0355    19                    KUPOS2: ADD  HL,DE        ;Kursorposition veraendern
  0356    CD 03DC                       CALL SCROLL 
  0359    10 FA                         DJNZ KUPOS2       ;1...9 mal wiederholen
  035B    18 CE                         JR   BSEND2 
                                ;
                                ; Kursor nach links und Zeichen loeschen
                                ;
  035D    23                    DELETE: INC  HL           ;Kursorposition++
  035E    CD 03DC                       CALL SCROLL 
  0361    36 20                         LD   (HL),20H 
  0363    18 C6                         JR   BSEND2 
                                ;
                                ; 0CH --> Kursor Home + Bildschirm loeschen
                                ;
  0365    21 17FF               BS0365: LD   HL,17FFH 
  0368    22 1800                       LD   (KURPOS),HL  ;Kursor Home
                                ;
                                ; 02H --> Bildschirm ab Kursor loeschen
                                ;
  036B    36 20                 BS036B: LD   (HL),20H     ;Bildschirm loeschen
  036D    2B                            DEC  HL 
  036E    7C                            LD   A,H 
  036F    FE 0F                         CP   0FH 
  0371    20 F8                         JR   NZ,BS036B 
  0373    18 B9                         JR   BSEND3 
                                ;
                                ; 03H --> Zeile ab Kursorposition loeschen
                                ;
  0375    36 20                 BS0375: LD   (HL),20H 
  0377    2B                    CLRLIN: DEC  HL 
  0378    36 20                         LD   (HL),20H 
  037A    3E 3F                         LD   A,3FH 
  037C    A5                            AND  L 
  037D    20 F8                         JR   NZ,CLRLIN 
  037F    18 AD                 CLREND: JR   BSEND3 
                                ;
                                ; 06H --> Kursor an den Anfang der Zeile
                                ;
  0381    7D                    BS0381: LD   A,L 
  0382    F6 3F                         OR   3FH 
  0384    6F                            LD   L,A 
  0385    18 A4                         JR   BSEND2 
                                ;
                                ; 07H --> akustisches Signal
                                ;
	MACRO-80 3.44	09-Dec-81	PAGE	1-17


  0387    CD 0272               BS0387: CALL TUELUE 
  038A    18 A2                         JR   BSEND3 
                                ;
                                ; 08H --> Kursor nach links
                                ;
  038C    23                    BS038C: INC  HL 
  038D    18 99                         JR   BSEND1 
                                ;
                                ; 0AH --> Kursor nach unten
                                ;
  038F    11 FFC0               BS038F: LD   DE,0FFC0H
  0392    19                    KURMOV: ADD  HL,DE 
  0393    18 93                         JR   BSEND1 
                                ;
                                ; 0BH --> Kursor nach oben
                                ;
  0395    11 0040               BS0395: LD   DE,0040H 
  0398    18 F8                         JR   KURMOV 
                                ;
                                ; 0DH --> CR; Kursor an den Anfang naechster Zeile
                                ;
  039A    7D                    BS039A: LD   A,L 
  039B    E6 C0                         AND  0C0H
  039D    6F                            LD   L,A 
  039E    18 87                         JR   BS0327 
                                ;
                                ; 0EH --> Kursor direkt positionieren
                                ;
  03A0    3E 05                 BS03A0: LD   A,05H        ;4 Argumente folgen (2x Zeile, 2x Spalte)
  03A2    12                            LD   (DE),A 
                                ;
                                ; 01H --> Home: Kursor nach oben links
                                ;
  03A3    21 17FF               BS03A3: LD   HL,17FFH 
  03A6    18 83                         JR   BSEND2 
                                ;
                                ; 04H --> Delete: 1 Zeichen loeschen, Zeile rueckt nach links
                                ;
  03A8    54                    BS03A8: LD   D,H 
  03A9    5D                            LD   E,L 
  03AA    2B                            DEC  HL 
  03AB    7D                    DELE1:  LD   A,L 
  03AC    ED A8                         LDD 
  03AE    E6 3F                         AND  3FH 
  03B0    20 F9                         JR   NZ,DELE1 
  03B2    13                            INC  DE 
  03B3    3E 20                 DELE2:  LD   A,20H 
  03B5    12                            LD   (DE),A 
  03B6    18 C7                         JR   CLREND 
                                ;
                                ; 05H --> Insert: Space einfuegen, Zeile rueckt nach rechts
                                ;
  03B8    7D                    BS03B8: LD   A,L 
  03B9    E6 C0                         AND  0C0H
  03BB    5F                            LD   E,A 
  03BC    7D                            LD   A,L 
  03BD    6B                            LD   L,E 
  03BE    54                            LD   D,H 
  03BF    23                            INC  HL 
  03C0    BB                    INSE1:  CP   E 
	MACRO-80 3.44	09-Dec-81	PAGE	1-18


  03C1    28 F0                         JR   Z,DELE2 
  03C3    ED A0                         LDI 
  03C5    18 F9                         JR   INSE1 
                                ;
                                ; Sprungverteiler (NWT) fuer BS-Befehle: (HWT = 03H)
                                ;
  03C7    2E                    BS03C7: DEFB 2EH          ;00H --> Fkt. verlassen
  03C8    A3                            DEFB 0A3H         ;01H --> Home: Kursor nach oben links (BS03A3)
  03C9    6B                            DEFB 6BH          ;02H --> Bildschirm ab Kursor loeschen (BS036B)
  03CA    75                            DEFB 75H          ;03H --> Zeile ab Kursorposition loeschen (BS0375)
  03CB    A8                            DEFB 0A8H         ;04H --> Delete: 1 Zeichen loeschen, Zeile rueckt nach links (BS03A8)
  03CC    B8                            DEFB 0B8H         ;05H --> Insert: Space einfuegen, Zeile rueckt nach rechts (BS03B8)
  03CD    81                            DEFB 81H          ;06H --> Kursor an den Anfang der Zeile (BS0381)
  03CE    87                            DEFB 87H          ;07H --> akustisches Signal (BS0387)
  03CF    8C                            DEFB 8CH          ;08H --> Kursor nach links (BS038C)
  03D0    27                            DEFB 27H          ;09H --> Kursor nach rechts (BS0327)
  03D1    8F                            DEFB 8FH          ;0AH --> Kursor nach unten (BS038F)
  03D2    95                            DEFB 95H          ;0BH --> Kursor nach oben (BS0395)
  03D3    65                            DEFB 65H          ;0CH --> Kursor Home, Bildschirm loeschen (BS0365)
  03D4    9A                            DEFB 9AH          ;0DH --> CR; Kursor an den Anfang naechster Zeile (BS039A)
  03D5    A0                            DEFB 0A0H         ;0EH --> Kursor direkt positionieren (BS03A0)
  03D6    D7                            DEFB 0D7H         ;0FH --> Tabulator 8 Spalten (BS03D7)
                                ;
                                ; 0FH --> Tabulator 8 Spalten
                                ;
  03D7    11 FFF8               BS03D7: LD   DE,0FFF8H
  03DA    18 B6                         JR   KURMOV 
                                ;
                                ; Bildschirm um 1 Zeile nach oben rollen
                                ;
  03DC    7C                    SCROLL: LD   A,H          ;HWT Kursorposition
  03DD    FE 18                         CP   18H          ;Kursor hat BS nach oben verlassen?
  03DF    38 02                         JR   C,SCROL1     ;nein
  03E1    26 10                         LD   H,10H        ;ja --> auf unterste BS-Zeile setzen
  03E3    FE 10                 SCROL1: CP   10H          ;HWT im Bereich 10H...17H?
  03E5    D0                            RET  NC           ;ja --> kein Scrollen erforderlich
  03E6    7D                            LD   A,L          ;NWT Kursorposition merken
  03E7    D5                            PUSH DE 
  03E8    C5                            PUSH BC 
  03E9    21 17BF                       LD   HL,17BFH 
  03EC    11 17FF                       LD   DE,17FFH 
  03EF    01 07C0                       LD   BC,07C0H 
  03F2    ED B8                         LDDR              ;1 Zeile nach oben scrollen
  03F4    EB                            EX   DE,HL 
  03F5    23                            INC  HL 
  03F6    2D                    SCROL2: DEC  L 
  03F7    36 20                         LD   (HL),20H     ;unterste Zeile loeschen
  03F9    20 FB                         JR   NZ,SCROL2 
  03FB    E6 3F                         AND  3FH 
  03FD    6F                            LD   L,A          ;Kursorposition NWT zurueck in L
  03FE    C1                            POP  BC 
  03FF    D1                            POP  DE 
  0400    C9                            RET 
                                ;
                                ;
                                ; Funktion "N" --> CRC - Pruefsumme (TODO)
                                ;
  0401    00 09 4E                      DEFB 00H,09H,4EH 
  0404    0D                    L0404:  DEC  C            ;= 0DH --> Der Sprung geht in die Kennung hinein
  0405    CD 04CA                       CALL ARGLD        ;ARG1-->HL ARG2-->DE ARG3-->BC 
	MACRO-80 3.44	09-Dec-81	PAGE	1-19


  0408    EB                            EX   DE,HL 
  0409    23                            INC  HL 
  040A    AF                            XOR  A 
  040B    ED 52                         SBC  HL,DE 
  040D    01 FFFF                       LD   BC,0FFFFH
  0410    1A                    L0410:  LD   A,(DE) 
  0411    A8                            XOR  B 
  0412    47                            LD   B,A 
  0413    0F                            RRCA 
  0414    0F                            RRCA 
  0415    0F                            RRCA 
  0416    0F                            RRCA 
  0417    E6 0F                         AND  0FH 
  0419    A8                            XOR  B 
  041A    47                            LD   B,A 
  041B    0F                            RRCA 
  041C    0F                            RRCA 
  041D    0F                            RRCA 
  041E    F5                            PUSH AF 
  041F    E6 1F                         AND  1FH 
  0421    A9                            XOR  C 
  0422    4F                            LD   C,A 
  0423    F1                            POP  AF 
  0424    F5                            PUSH AF 
  0425    0F                            RRCA 
  0426    E6 F0                         AND  0F0H
  0428    A9                            XOR  C 
  0429    4F                            LD   C,A 
  042A    F1                            POP  AF 
  042B    E6 E0                         AND  0E0H
  042D    A8                            XOR  B 
  042E    41                            LD   B,C 
  042F    4F                            LD   C,A 
  0430    13                            INC  DE 
  0431    2B                            DEC  HL 
  0432    7C                            LD   A,H 
  0433    B5                            OR   L 
  0434    20 DA                         JR   NZ,L0410 
  0436    C5                            PUSH BC 
  0437    DF                            RST  18H 
  0438    20 43 52 43                   DEFM " CRC" 
  043C    A0                            DEFB 20H+80H 
  043D    E1                            POP  HL 
  043E    C3 019A                       JP   OUTHL 
                                ;
                                ;
                                ; ??? (TODO)
                                ;
  0441    41                    L0441:  LD   B,C 
  0442    23                            INC  HL 
  0443    2B                    L0443:  DEC  HL 
  0444    10 FD                         DJNZ L0443 
  0446    22 185D                       LD   (ARG2),HL 
  0449    DF                            RST  18H 
  044A    06 83                         DEFB 06H,03H+80H  ;Kursor an Zeilenanfang + Zeile ab Kursor loeschen
  044C    06 0C                         LD   B,0CH 
  044E    DF                    L044E:  RST  18H 
  044F    89                            DEFB 09H+80H 
  0450    10 FC                         DJNZ L044E 
  0452    CD 07F1                       CALL L07F1 
	MACRO-80 3.44	09-Dec-81	PAGE	1-20


  0455    ED 5B 1800                    LD   DE,(KURPOS) 
  0459    DF                            RST  18H 
  045A    3E                            DEFM ">" 
  045B    A0                            DEFB 20H+80H 
  045C    06 08                         LD   B,08H 
  045E    7E                    L045E:  LD   A,(HL) 
  045F    23                            INC  HL 
  0460    DF                            RST  18H 
  0461    A0                            DEFB 20H+80H 
  0462    CD 07EE                       CALL L07EE 
  0465    10 F7                         DJNZ L045E 
  0467    DF                            RST  18H 
  0468    20 20 2A                      DEFM "  *" 
  046B    A0                            DEFB 20H+80H 
  046C    2A 185D                       LD   HL,(ARG2) 
  046F    06 08                         LD   B,08H 
  0471    7E                    L0471:  LD   A,(HL) 
  0472    23                            INC  HL 
  0473    CD 0487                       CALL L0487 
  0476    30 02                         JR   NC,L047A 
  0478    3E 2E                         LD   A,2EH 
  047A    D7                    L047A:  RST  10H 
  047B    10 F4                         DJNZ L0471 
  047D    22 185B                       LD   (ARG1),HL 
  0480    DF                            RST  18H 
  0481    20 2A                         DEFM " *" 
  0483    06                            DEFB 06H 
  0484    20                            DEFM " " 
  0485    86                            DEFB 06H+80H 
  0486    C9                            RET 
                                ;
                                        IFDEF MONI88      ;Monitor 10/88 - Originalversion 1988
  0487    FE 5F                 L0487:  CP   5FH
                                        ENDIF
                                        IFDEF MONI88A     ;Monitor 10/88 - Originalversion mit Anpassungen
                                L0487:  CP   7FH
                                        ENDIF
                                        IFDEF MONI11      ;Monitor 10/88 - BWS-CPLD-Version 2011
                                L0487:  CP   7FH
                                        ENDIF
                                        IFDEF MONI11A     ;Monitor 10/88 - BWS-CPLD-Version mit Anpassungen
                                L0487:  CP   7FH
                                        ENDIF
  0489    28 09                         JR   Z,L0494 
  048B    FE 20                         CP   20H 
  048D    D8                            RET  C 
  048E    FE 7F                         CP   7FH 
  0490    30 02                         JR   NC,L0494 
  0492    A7                    L0492:  AND  A 
  0493    C9                            RET 
                                ;
  0494    37                    L0494:  SCF 
  0495    C9                            RET 
                                ;
  0496    FE 47                 L0496:  CP   47H 
  0498    30 FA                         JR   NC,L0494 
  049A    FE 30                         CP   30H 
  049C    D8                            RET  C 
  049D    FE 3A                         CP   3AH 
  049F    38 F1                         JR   C,L0492 
	MACRO-80 3.44	09-Dec-81	PAGE	1-21


  04A1    FE 41                         CP   41H 
  04A3    C9                            RET 
                                ;
  04A4    DF                    L04A4:  RST  18H 
  04A5    86                            DEFB 06H+80H 
  04A6    06 0C                         LD   B,0CH 
  04A8    DF                    L04A8:  RST  18H 
  04A9    A0                            DEFB 20H+80H 
  04AA    10 FC                         DJNZ L04A8 
  04AC    C9                            RET 
                                ;
  04AD    D9                    L04AD:  EXX 
  04AE    1A                            LD   A,(DE) 
  04AF    A7                            AND  A 
  04B0    28 03                         JR   Z,L04B5 
  04B2    FE 02                         CP   02H 
  04B4    7E                            LD   A,(HL) 
  04B5    13                    L04B5:  INC  DE 
  04B6    23                            INC  HL 
  04B7    D9                            EXX 
  04B8    C9                            RET 
                                ;
                                ;
                                        IFDEF MONI88      ;Monitor 10/88 - Originalversion 1988
  04B9                                  DEFS 17,0FFH      ;Platzhalter 17 Byte
                                        ENDIF
                                        IFDEF MONI88A     ;Monitor 10/88 - Originalversion mit Anpassungen
                                        DEFS 17,0FFH      ;Platzhalter 17 Byte
                                        ENDIF
                                        IFDEF MONI11      ;Monitor 10/88 - BWS-CPLD-Version 2011
                                ;
                                ; Funktion "Y" --> alternativer Monitor im RAM
                                ;
                                        DEFB 00H,09H,59H,0DH 
                                        CALL ARGLD        ;ARG1-->HL ARG2-->DE ARG3-->BC
                                        LD   B,10H        ;BC = 1000H, DE = 0000H
                                        LDIR 
                                        LD   HL,16D3H     ;OUT (P16),A --> RAM einblenden
                                        JP   ALTMO 
                                ;
                                        ENDIF
                                        IFDEF MONI11A     ;Monitor 10/88 - BWS-CPLD-Version mit Anpassungen
                                ;
                                ; Funktion "Y" --> alternativer Monitor im RAM
                                ;
                                        DEFB 00H,09H,59H,0DH 
                                        CALL ARGLD        ;ARG1-->HL ARG2-->DE ARG3-->BC
                                        LD   B,10H        ;BC = 1000H, DE = 0000H 
                                        LDIR 
                                        LD   HL,16D3H     ;OUT (P16),A --> RAM einblenden
                                        JP   ALTMO 
                                ;
                                        ENDIF
                                ;
                                ;
                                ; Register mit Argumenten laden
                                ; -----------------------------
                                ;
  04CA    2A 185B               ARGLD:  LD   HL,(ARG1) 
  04CD    ED 5B 185D                    LD   DE,(ARG2) 
	MACRO-80 3.44	09-Dec-81	PAGE	1-22


  04D1    ED 4B 185F                    LD   BC,(ARG3) 
  04D5    C9                            RET 
                                ;
  04D6                                  DEFS 2,0FFH       ;Platzhalter 2 Byte
                                ;
                                ; Funktion "P" --> Pattern
                                ;
  04D8    00 09 50 0D                   DEFB 00H,09H,50H,0DH 
  04DC    CD 04CA                       CALL ARGLD        ;ARG1-->HL ARG2-->DE ARG3-->BC 
  04DF    71                            LD   (HL),C       ;Pattern --> (HL)
  04E0    E5                            PUSH HL 
  04E1    AF                            XOR  A            ;wegen SBC-Befehl
  04E2    EB                            EX   DE,HL 
  04E3    ED 52                         SBC  HL,DE        ;Wert fuer BC berechnen
  04E5    44                            LD   B,H 
  04E6    4D                            LD   C,L 
  04E7    E1                            POP  HL           ;HL zurueck
  04E8    13                            INC  DE           ;DE = HL + 1
  04E9    ED B0                 JPLDIR: LDIR 
  04EB    C9                            RET 
                                ;
                                ;
                                ; Funktion "T" --> Transfer
                                ;
  04EC    00 09 54 0D                   DEFB 00H,09H,54H,0DH 
  04F0    CD 04CA                       CALL ARGLD        ;ARG1-->HL ARG2-->DE ARG3-->BC 
  04F3    AF                            XOR  A            ;wegen SBC-Befehl
  04F4    E5                            PUSH HL 
  04F5    ED 52                         SBC  HL,DE        ;Carry-Flag wird bei HL < DE gesetzt
  04F7    E1                            POP  HL 
  04F8    30 EF                         JR   NC,JPLDIR    ;Sprung zum LDIR-Befehl (HL >= DE)
  04FA    09                            ADD  HL,BC
  04FB    EB                            EX   DE,HL 
  04FC    09                            ADD  HL,BC 
  04FD    EB                            EX   DE,HL 
  04FE    2B                            DEC  HL           ;HL = HL + BC - 1
  04FF    1B                            DEC  DE           ;DE = DE + BC - 1
  0500    ED B8                         LDDR              ;HL und DE zaehlen nach unten
  0502    C9                            RET 
                                ;
                                ;
                                ; Funktion "A" --> Arithmetik (TODO)
                                ;
  0503    00 09 41 0D                   DEFB 00H,09H,41H,0DH 
  0507    CD 04CA                       CALL ARGLD        ;ARG1-->HL ARG2-->DE ARG3-->BC 
  050A    E5                            PUSH HL 
  050B    D5                            PUSH DE 
  050C    23                            INC  HL 
  050D    23                            INC  HL 
  050E    EB                            EX   DE,HL 
  050F    AF                            XOR  A 
  0510    ED 52                         SBC  HL,DE 
  0512    38 09                         JR   C,L051D 
  0514    BC                            CP   H 
  0515    20 18                         JR   NZ,L052F 
  0517    CB 7D                         BIT  7,L 
  0519    20 14                         JR   NZ,L052F 
  051B    18 08                         JR   L0525 
                                ;
  051D    2F                    L051D:  CPL 
	MACRO-80 3.44	09-Dec-81	PAGE	1-23


  051E    BC                            CP   H 
  051F    20 0E                         JR   NZ,L052F 
  0521    CB 7D                         BIT  7,L 
  0523    28 0A                         JR   Z,L052F 
  0525    DF                    L0525:  RST  18H 
  0526    44 53 50 4C                   DEFM "DSPL" 
  052A    BA                            DEFB 3AH+80H      ;":+80H 
  052B    7D                            LD   A,L 
  052C    CD 0183                       CALL OUTHEX 
  052F    D1                    L052F:  POP  DE 
  0530    E1                            POP  HL 
  0531    E5                            PUSH HL 
  0532    E5                            PUSH HL 
  0533    19                            ADD  HL,DE 
  0534    DF                            RST  18H 
  0535    20 20 20 53                   DEFM "   SUM" 
  0539    55 4D                 
  053B    BA                            DEFB 3AH+80H      ;":+80H 
  053C    CD 019A                       CALL OUTHL 
  053F    E1                            POP  HL 
  0540    ED 52                         SBC  HL,DE 
  0542    DF                            RST  18H 
  0543    20 20 20 44                   DEFM "   DIF" 
  0547    49 46                 
  0549    BA                            DEFB 3AH+80H      ;":+80H 
  054A    CD 019A                       CALL OUTHL 
  054D    C1                            POP  BC 
  054E    21 0000                       LD   HL,0000H 
  0551    5D                            LD   E,L 
  0552    78                    L0552:  LD   A,B 
  0553    B1                            OR   C 
  0554    28 0F                         JR   Z,L0565 
  0556    0B                            DEC  BC 
  0557    7D                            LD   A,L 
  0558    3C                            INC  A 
  0559    27                            DAA 
  055A    6F                            LD   L,A 
  055B    7C                            LD   A,H 
  055C    CE 00                         ADC  A,00H 
  055E    27                            DAA 
  055F    67                            LD   H,A 
  0560    30 F0                         JR   NC,L0552 
  0562    1C                            INC  E 
  0563    18 ED                         JR   L0552 
                                ;
  0565    DF                    L0565:  RST  18H 
  0566    20 20 20 44                   DEFM "   DEC" 
  056A    45 43                 
  056C    BA                            DEFB 3AH+80H      ;":+80H 
  056D    7B                            LD   A,E 
  056E    E6 0F                         AND  0FH 
  0570    F6 30                         OR   30H 
  0572    D7                            RST  10H 
  0573    CD 019A                       CALL OUTHL 
  0576    DF                            RST  18H 
  0577    8D                            DEFB 0DH+80H 
  0578    C9                            RET 
                                ;
                                ;
                                ; ??? (TODO)
	MACRO-80 3.44	09-Dec-81	PAGE	1-24


                                ;
  0579    4F                    L0579:  LD   C,A 
  057A    21 05BE                       LD   HL,05BEH 
  057D    06 08                         LD   B,08H 
  057F    CB 01                 L057F:  RLC  C 
  0581    30 02                         JR   NC,L0585 
  0583    7E                            LD   A,(HL) 
  0584    D7                            RST  10H 
  0585    23                    L0585:  INC  HL 
  0586    10 F7                         DJNZ L057F 
  0588    C9                            RET 
                                ;
                                ;
                                ; UP OUTHL1
                                ; gibt das HL-Register als vierstellige Hexzahl auf dem Schirm aus
                                ;
                                
  0589    CD 019A               OUTHL1: CALL OUTHL        ;HL auf dem Bildschirm ausgeben
  058C    DF                    OUTHL2: RST  18H          ;4 Leerzeichen auf dem BS ausgeben
  058D    20 20 20                      DEFM "   " 
  0590    A0                            DEFB 20H+80H 
  0591    C9                            RET 
                                ;
                                ;
                                ; Texte (TODO)
                                ;
  0592    41 42 44 48                   DEFB 41H,42H,44H,48H ;ABDH
  0596    58 59 43 50                   DEFB 58H,59H,43H,50H ;XYCP
  059A    20 20 20 20                   DEFB 20H,20H,20H,20H
  059E    53 50 50 43                   DEFB 53H,50H,50H,43H ;SPPC
  05A2    49 59 49 58                   DEFB 49H,59H,49H,58H ;IYIX
  05A6    4D 41 49 4E                   DEFB 4DH,41H,49H,4EH ;MAIN
  05AA    48 4C 44 45                   DEFB 48H,4CH,44H,45H ;HLDE
  05AE    42 43 41 46                   DEFB 42H,43H,41H,46H ;BCAF
  05B2    45 58 58 52                   DEFB 45H,58H,58H,52H ;EXXR
  05B6    48 4C 44 45                   DEFB 48H,4CH,44H,45H ;HLDE
  05BA    42 43 41 46                   DEFB 42H,43H,41H,46H ;BCAF
  05BE    53 5A 00 48                   DEFB 53H,5AH,00H,48H ;SZ.H
  05C2    00 50 4E 43                   DEFB 00H,50H,4EH,43H ;.PNC
                                ;
                                ;
                                ; Funktion "R" --> Register (TODO)
                                ;
  05C6    00 09 52 0D                   DEFB 00H,09H,52H,0DH 
  05CA    FE 3A                         CP   3AH 
  05CC    20 6F                         JR   NZ,L063D 
  05CE    DF                    L05CE:  RST  18H 
  05CF    20 20 42 50                   DEFM "  BP" 
  05D3    BA                            DEFB 3AH+80H      ;":+80H 
  05D4    2A 1879                       LD   HL,(1879H) 
  05D7    CD 0589                       CALL OUTHL1       ;HL auf dem Bildschirm ausgeben
  05DA    DF                            RST  18H 
  05DB    42 53                         DEFM "BS" 
  05DD    BA                            DEFB 3AH+80H      ;":+80H 
  05DE    21 187B                       LD   HL,187BH 
  05E1    06 03                         LD   B,03H 
  05E3    7E                    L05E3:  LD   A,(HL) 
  05E4    CD 0183                       CALL OUTHEX 
  05E7    23                            INC  HL 
  05E8    10 F9                         DJNZ L05E3 
	MACRO-80 3.44	09-Dec-81	PAGE	1-25


  05EA    0E 03                         LD   C,03H 
  05EC    11 059A                       LD   DE,059AH 
  05EF    DD 21 1878                    LD   IX,1878H 
  05F3    DF                    L05F3:  RST  18H 
  05F4    0D                            DEFB 0DH 
  05F5    20                            DEFM " " 
  05F6    A0                            DEFB 20H+80H 
  05F7    06 04                         LD   B,04H 
  05F9    1A                    L05F9:  LD   A,(DE) 
  05FA    D7                            RST  10H 
  05FB    13                            INC  DE 
  05FC    10 FB                         DJNZ L05F9 
  05FE    DF                            RST  18H 
  05FF    20                            DEFM " " 
  0600    A0                            DEFB 20H+80H 
  0601    06 04                         LD   B,04H 
  0603    1A                    L0603:  LD   A,(DE) 
  0604    D7                            RST  10H 
  0605    13                            INC  DE 
  0606    1A                            LD   A,(DE) 
  0607    D7                            RST  10H 
  0608    13                            INC  DE 
  0609    DF                            RST  18H 
  060A    BA                            DEFB 3AH+80H      ;":+80H 
  060B    DD 66 00                      DEFB 0DDH,66H,00H ;Befehl = LD H,(IX+d)
  060E    DD 2B                         DEC  IX 
  0610    DD 6E 00                      DEFB 0DDH,6EH,00H ;Befehl = LD L,(IX+d)
  0613    DD 2B                         DEC  IX 
  0615    CD 0589                       CALL OUTHL1       ;HL auf dem Bildschirm ausgeben
  0618    10 E9                         DJNZ L0603 
  061A    0D                            DEC  C 
  061B    20 D6                         JR   NZ,L05F3 
  061D    DF                            RST  18H 
  061E    0D                            DEFB 0DH 
  061F    20 20 46 4C                   DEFM "  FLAGS: " 
  0623    41 47 53 3A           
  0627    20                    
  0628    A0                            DEFB 20H+80H 
  0629    3A 1869                       LD   A,(1869H) 
  062C    CD 0579                       CALL L0579 
  062F    DF                            RST  18H 
  0630    20 20                         DEFM "  " 
  0632    A8                            DEFB 28H+80H      ;"(+80H 
  0633    3A 1861                       LD   A,(1861H) 
  0636    CD 0579                       CALL L0579 
  0639    DF                            RST  18H 
  063A    29                            DEFM ")" 
  063B    8D                            DEFB 0DH+80H 
  063C    C9                            RET 
                                ;
                                ;
                                ; ??? (TODO)
                                ;
  063D    2A 181A               L063D:  LD   HL,(ZWINL) 
  0640    2B                            DEC  HL 
  0641    2B                            DEC  HL 
  0642    7E                            LD   A,(HL) 
  0643    E5                            PUSH HL 
  0644    21 0592                       LD   HL,0592H 
  0647    06 04                         LD   B,04H 
	MACRO-80 3.44	09-Dec-81	PAGE	1-26


  0649    11 1869                       LD   DE,1869H 
  064C    BE                    L064C:  CP   (HL) 
  064D    28 16                         JR   Z,L0665 
  064F    13                            INC  DE 
  0650    13                            INC  DE 
  0651    23                            INC  HL 
  0652    10 F8                         DJNZ L064C 
  0654    C1                            POP  BC 
  0655    0B                            DEC  BC 
  0656    0A                            LD   A,(BC) 
  0657    06 04                         LD   B,04H 
  0659    BE                    L0659:  CP   (HL) 
  065A    28 17                         JR   Z,L0673 
  065C    13                            INC  DE 
  065D    13                            INC  DE 
  065E    23                            INC  HL 
  065F    10 F8                         DJNZ L0659 
  0661    C3 05CE                       JP   L05CE 
                                ;
  0664    FF                            DEFB 0FFH         ;Platzhalter 1 Byte
                                ;
                                ;
                                ; ??? (TODO)
                                ;
  0665    E1                    L0665:  POP  HL 
  0666    2B                            DEC  HL 
  0667    2B                            DEC  HL 
  0668    7E                            LD   A,(HL) 
  0669    EB                            EX   DE,HL 
  066A    FE 27                         CP   27H 
  066C    20 04                         JR   NZ,L0672 
  066E    11 FFF8                       LD   DE,0FFF8H
  0671    19                            ADD  HL,DE 
  0672    EB                    L0672:  EX   DE,HL 
  0673    1A                    L0673:  LD   A,(DE) 
  0674    6F                            LD   L,A 
  0675    13                            INC  DE 
  0676    1A                            LD   A,(DE) 
  0677    67                            LD   H,A 
  0678    DF                            RST  18H 
  0679    20                            DEFM " " 
  067A    A0                            DEFB 20H+80H 
  067B    CD 019A                       CALL OUTHL 
                                ; dieses UP liest die Eingabezeile auf dem Monitor,
                                ; wandelt den eingegebenen ASCII-Wert (4 Stellen) in 
                                ; eine 16-bit HEX-Zahl und speichert die Eingabe
                                ; (wenn etwas eingegeben wurde) in (DE-1) und (DE)
  067E    CD 0128               INHEX4: CALL INLINE 
  0681    2A 181A                       LD   HL,(ZWINL)   ;Adresse Zeilenanfang in HL
  0684    EB                            EX   DE,HL
  0685    E5                            PUSH HL           ;DE = Speicheradresse + 1
  0686    D5                            PUSH DE           ;Adresse BS-Zeilenanfang
  0687    CD 0172                       CALL INHEX        ;Umwandlung ASCII --> HEX
  068A    EB                            EX   DE,HL        ;HEX-Ergebnis jetzt in DE
  068B    E1                            POP  HL           ;Adresse BS-Zeilenanfang
  068C    7E                            LD   A,(HL)       ;1. Zeichen ASCII-Eingabe vom BS lesen
  068D    E1                            POP  HL           ;HL = Speicheradresse + 1
  068E    FE 20                         CP   20H          ;Leerzeichen?
  0690    C8                            RET  Z            ;es wurde kein Wert eingegeben
  0691    72                            LD   (HL),D       ;eingegebenen Wert speichern
	MACRO-80 3.44	09-Dec-81	PAGE	1-27


  0692    2B                            DEC  HL 
  0693    73                            LD   (HL),E 
  0694    C9                            RET 
                                ;
                                ;
                                ; Funktion "C" --> Compare
                                ;
  0695    00 09 43 0D                   DEFB 00H,09H,43H,0DH 
  0699    CD 04CA                       CALL ARGLD        ;ARG1-->HL ARG2-->DE ARG3-->BC 
  069C    1A                    COMP1:  LD   A,(DE) 
  069D    BE                            CP   (HL) 
  069E    28 1F                         JR   Z,COMP2      ;(HL) und (DE) sind identisch
  06A0    DF                            RST  18H          ;Ausgabe der Differenz:
  06A1    20                            DEFM " " 
  06A2    A0                            DEFB 20H+80H 
  06A3    CD 0589                       CALL OUTHL1       ;HL auf dem Bildschirm ausgeben
  06A6    7E                            LD   A,(HL) 
  06A7    CD 0183                       CALL OUTHEX       ;(HL) auf dem Bildschirm ausgeben
  06AA    CD 058C                       CALL OUTHL2       ;4 Leerzeichen auf dem BS ausgeben
  06AD    CD 058C                       CALL OUTHL2       ;dto.
  06B0    EB                            EX   DE,HL 
  06B1    CD 0589                       CALL OUTHL1       ;DE auf dem Bildschirm ausgeben
  06B4    EB                            EX   DE,HL 
  06B5    1A                            LD   A,(DE) 
  06B6    CD 0183                       CALL OUTHEX       ;(DE) auf dem Bildschirm ausgeben
  06B9    DF                            RST  18H 
  06BA    8D                            DEFB 0DH+80H      ;neue Zeile und Tastaturabfrage:
  06BB    CF                            RST  08H
  06BC    FE 0D                         CP   0DH          ;<ENTER> gedrueckt?
  06BE    C0                            RET  NZ           ;nein --> die Routine beenden
  06BF    0B                    COMP2:  DEC  BC           ;ja --> weiter vergleichen
  06C0    23                            INC  HL 
  06C1    13                            INC  DE           ;HL++; DE++; BC--;
  06C2    78                            LD   A,B 
  06C3    B1                            OR   C 
  06C4    C8                            RET  Z            ;Ende bei BC = 0
  06C5    18 D5                         JR   COMP1        ;naechster Vergleich
                                ;
                                ;
                                ; Funktion "B" --> Breakpoint
                                ;
  06C7    00 09 42 0D                   DEFB 00H,09H,42H,0DH 
  06CB    2A 185B                       LD   HL,(ARG1) 
  06CE    22 1879               L06CE:  LD   (1879H),HL   ;BP-Adresse merken
  06D1    11 187B                       LD   DE,187BH     ;Merkzellen fuer urspruenglichen Code
  06D4    01 0003                       LD   BC,0003H     ;3 Bytes ab BP sichern
  06D7    ED B0                         LDIR 
  06D9    21 0743                       LD   HL,RUNBP     ;Routine fuer Breakpoint-Bearbeitung
  06DC    22 1815                       LD   (1815H),HL   ;Sprungtabelle fuer RST38 patchen
  06DF    C9                            RET 
                                ;
                                ;
                                ; Funktion "G" --> Go
                                ;
  06E0    00 09 47 0D                   DEFB 00H,09H,47H,0DH
  06E4    2A 1875                       LD   HL,(1875H)   ;PC-Register --> HL
  06E7    22 185B                       LD   (ARG1),HL    ;als ARG1 speichern und weiter mit "J"
                                ;
                                ;
                                ; Funktion "J" --> Jump
	MACRO-80 3.44	09-Dec-81	PAGE	1-28


                                ;
  06EA    00 09 4A 0D                   DEFB 00H,09H,4AH,0DH
  06EE    3A 1815                       LD   A,(1815H)    ;nachschauen, wie die Sprungtab. f. RST38 aussieht
  06F1    FE 40                         CP   40H          ;Test, ob "BREAK" (0240H) eingetragen ist
  06F3    28 05                         JR   Z,JUMP1      ;ja, es wurde also kein Breakpoint gesetzt
  06F5    2A 1879                       LD   HL,(1879H)   ;nein, lade Breakpoint-Adresse
  06F8    36 FF                         LD   (HL),0FFH    ;setze "RST38" auf Breakpoint-Adresse
  06FA    2A 1877               JUMP1:  LD   HL,(1877H)   ;lade SP-Adresse
  06FD    06 0A                         LD   B,10         ;Teste fuer den Stackpointer 10 Bytes abwaerts, 
  06FF    2B                            DEC  HL           ;ob er im RAM oder auf dem EPROM unterwegs ist...
  0700    7E                    JUMP2:  LD   A,(HL) 
  0701    2F                            CPL               ;Bitweises Negieren von A
  0702    77                            LD   (HL),A 
  0703    BE                            CP   (HL) 
  0704    20 08                         JR   NZ,JUMP3     ;das ist 'ne EPROM-Zelle --> SP = 2000H setzen!
  0706    2F                            CPL               ;alles wieder zurueckdrehen
  0707    77                            LD   (HL),A 
  0708    10 F6                         DJNZ JUMP2 
  070A    2A 1877                       LD   HL,(1877H)   ;alles RAM-Speicher --> SP = (1877H)
  070D    DD                            DEFB 0DDH         ;LD IX,2000H (+ nxt. Befehl ueberspringen, genial!)
  070E    21 2000               JUMP3:  LD   HL,2000H
  0711    F9                            LD   SP,HL        ;SP setzen
  0712    2A 185B                       LD   HL,(ARG1) 
  0715    22 1875                       LD   (1875H),HL   ;HL-->PC
  0718    E5                            PUSH HL           ;Startadresse in den Stack
  0719    C3 01BC                       JP   RSACPU       ;UP, CPU-Register einraeumen von RSA
                                ;
                                ;
                                ; Funktion "E" --> Einzelschritt (TODO)
                                ;
  071C    00 09 45 0D                   DEFB 00H,09H,45H,0DH 
  0720    1A                            LD   A,(DE) 
  0721    FE 3A                         CP   3AH 
  0723    28 06                         JR   Z,L072B 
  0725    2A 185B                       LD   HL,(ARG1) 
  0728    22 1875               EINZ1:  LD   (1875H),HL 
  072B    ED 7B 1877            L072B:  LD   SP,(1877H) 
  072F    2A 1875                       LD   HL,(1875H) 
  0732    E5                            PUSH HL 
  0733    CD 01BC                       CALL RSACPU       ;UP, CPU-Register einraeumen von RSA 
  0736    F5                            PUSH AF 
  0737    3E 87                         LD   A,87H 
  0739    D3 00                         OUT  (P00),A 
  073B    3E 02                         LD   A,02H 
  073D    D3 00                         OUT  (P00),A 
  073F    FB                            EI 
  0740    0A                            LD   A,(BC) 
  0741    F1                            POP  AF 
  0742    C9                            RET 
                                ;
                                ;
                                ; Routine fuer Breakpoint
                                ;
  0743    CD 01A5               RUNBP:  CALL CPURSA       ;UP, CPU-Register ausraeumen nach RSA 
  0746    2A 0233                       LD   HL,(0233H)   ;orig. Einsprungpunkt fuer RST38
  0749    22 1815                       LD   (1815H),HL   ;in den Sprungverteiler zurueckschreiben
  074C    E1                            POP  HL           ;PC nach RST38 aus dem Stack holen
  074D    2B                            DEC  HL 
  074E    3A 187B                       LD   A,(187BH)    ;1. Byte der BP-Sequenz 
  0751    77                            LD   (HL),A       ;urspr. 1. Byte zurueckschreiben 
	MACRO-80 3.44	09-Dec-81	PAGE	1-29


  0752    ED 73 1877                    LD   (1877H),SP   ;SP sichern
  0756    18 D0                         JR   EINZ1 
                                ;
  0758                                  DEFS 3,0FFH       ;Platzhalter 3 Byte
                                ;
                                ;
                                ; ??? (TODO)
                                ;
  075B    CD 01A5                       CALL CPURSA       ;UP, CPU-Register ausraeumen nach RSA 
  075E    D1                            POP  DE 
  075F    ED 73 1877                    LD   (1877H),SP 
  0763    2A 1875                       LD   HL,(1875H) 
  0766    ED 53 1875                    LD   (1875H),DE 
  076A    31 1856                       LD   SP,1856H     ;Stack 
  076D    DF                            RST  18H 
  076E    06 A0                         DEFB 06H,20H+80H  ;Kursor an Zeilenanfang + 1 Leerzeichen
  0770    CD 019A                       CALL OUTHL 
  0773    06 05                         LD   B,05H 
  0775    DF                    L0775:  RST  18H 
  0776    A0                            DEFB 20H+80H 
  0777    E5                            PUSH HL 
  0778    AF                            XOR  A 
  0779    ED 52                         SBC  HL,DE 
  077B    E1                            POP  HL 
  077C    28 07                         JR   Z,L0785 
  077E    7E                    L077E:  LD   A,(HL) 
  077F    23                            INC  HL 
  0780    CD 0183                       CALL OUTHEX 
  0783    18 08                         JR   L078D 
                                ;
  0785    3E 05                 L0785:  LD   A,05H 
  0787    B8                            CP   B 
  0788    28 F4                         JR   Z,L077E 
  078A    DF                            RST  18H 
  078B    20                            DEFM " " 
  078C    A0                            DEFB 20H+80H 
  078D    10 E6                 L078D:  DJNZ L0775 
  078F    06 04                         LD   B,04H 
  0791    11 05AA                       LD   DE,05AAH 
  0794    21 1870                       LD   HL,1870H 
  0797    DF                    L0797:  RST  18H 
  0798    A0                            DEFB 20H+80H 
  0799    1A                            LD   A,(DE) 
  079A    D7                            RST  10H 
  079B    13                            INC  DE 
  079C    1A                            LD   A,(DE) 
  079D    D7                            RST  10H 
  079E    13                            INC  DE 
  079F    DF                            RST  18H 
  07A0    BA                            DEFB 3AH+80H      ;":+80H 
  07A1    7E                            LD   A,(HL) 
  07A2    2B                            DEC  HL 
  07A3    E5                            PUSH HL 
  07A4    6E                            LD   L,(HL) 
  07A5    67                            LD   H,A 
  07A6    CD 019A                       CALL OUTHL 
  07A9    E1                            POP  HL 
  07AA    2B                            DEC  HL 
  07AB    10 EA                         DJNZ L0797 
  07AD    DF                            RST  18H 
	MACRO-80 3.44	09-Dec-81	PAGE	1-30


  07AE    20 46                         DEFM " F" 
  07B0    BA                            DEFB 3AH+80H      ;":+80H 
  07B1    3A 1869                       LD   A,(1869H) 
  07B4    CD 0579                       CALL L0579 
  07B7    DF                            RST  18H 
  07B8    0D A0                         DEFB 0DH,0A0H 
  07BA    2A 1875                       LD   HL,(1875H) 
  07BD    CD 019A                       CALL OUTHL 
  07C0    06 05                         LD   B,05H 
  07C2    DF                    L07C2:  RST  18H 
  07C3    A0                            DEFB 20H+80H 
  07C4    7E                            LD   A,(HL) 
  07C5    23                            INC  HL 
  07C6    CD 0183                       CALL OUTHEX 
  07C9    10 F7                         DJNZ L07C2 
  07CB    3E 03                         LD   A,03H 
  07CD    D3 00                         OUT  (P00),A 
  07CF    D7                    L07CF:  RST  10H 
  07D0    CF                    L07D0:  RST  08H 
  07D1    21 06E4                       LD   HL,06E4H 
  07D4    FE 47                         CP   47H 
  07D6    28 2C                         JR   Z,L0804 
  07D8    21 072B                       LD   HL,072BH 
  07DB    FE 0D                         CP   0DH 
  07DD    28 25                         JR   Z,L0804 
  07DF    FE 20                         CP   20H 
  07E1    38 EC                         JR   C,L07CF 
  07E3    21 01DE                       LD   HL,01DEH     ;Adresse Kommandozeicheneingabe
  07E6    18 18                         JR   L0800 
                                ;
                                ;
                                ; Sprungverteiler
                                ;
  07E8    C3 0DF9               L07E8:  JP   V24OUT       ;V.24 Ausgabe
  07EB    C3 011D               L07EB:  JP   MS30         ;MS 30
  07EE    C3 0183               L07EE:  JP   OUTHEX       ;OUTHEX
  07F1    C3 019A               L07F1:  JP   OUTHL        ;OUT HL
  07F4    C3 0128               L07F4:  JP   INLINE       ;INLINE
  07F7    C3 0172               L07F7:  JP   INHEX        ;INHEX
  07FA    C3 0D4D               L07FA:  JP   TASTE        ;TASTE
  07FD    C3 025B               L07FD:  JP   GETCO        ;GETCO
                                ;
                                ;
                                ; Fortsetzung von oben
                                ;
  0800    FE 51                 L0800:  CP   51H 
  0802    20 03                         JR   NZ,L0807 
  0804    E5                    L0804:  PUSH HL 
  0805    ED 4D                         RETI 
                                ;
  0807    FE 42                 L0807:  CP   42H 
  0809    20 18                         JR   NZ,L0823 
  080B    DF                            RST  18H 
  080C    20 42                         DEFM " B" 
  080E    D0                            DEFB 50H+80H      ;"P+80H 
  080F    CD 0128                       CALL INLINE 
  0812    2A 181A                       LD   HL,(ZWINL) 
  0815    7E                            LD   A,(HL) 
  0816    FE 20                         CP   20H 
  0818    28 B6                         JR   Z,L07D0 
	MACRO-80 3.44	09-Dec-81	PAGE	1-31


  081A    EB                            EX   DE,HL 
  081B    CD 0172                       CALL INHEX 
  081E    CD 06CE                       CALL L06CE 
  0821    18 AD                         JR   L07D0 
                                ;
  0823    FE 52                 L0823:  CP   52H 
  0825    CC 0128                       CALL Z,INLINE 
  0828    CC 063D                       CALL Z,L063D 
  082B    18 A3                         JR   L07D0 
                                ;
                                ;
                                ; Funktion "D" --> Dump (TODO)
                                ;
  082D    00 09 44 0D                   DEFB 00H,09H,44H,0DH 
  0831    DD 2A 185D                    LD   IX,(ARG2) 
  0835    AF                            XOR  A 
  0836    32 185F                       LD   (ARG3),A 
  0839    21 185D                       LD   HL,ARG2 
  083C    3A 185E                       LD   A,(185EH) 
  083F    B6                            OR   (HL) 
  0840    32 1860                       LD   (1860H),A 
  0843    DF                            RST  18H 
  0844    2A                            DEFM "*" 
  0845    8D                            DEFB 0DH+80H 
  0846    0E 01                 L0846:  LD   C,01H 
  0848    2A 185B                       LD   HL,(ARG1) 
  084B    7D                            LD   A,L 
  084C    E6 F8                         AND  0F8H
  084E    6F                            LD   L,A 
  084F    CD 0441                       CALL L0441 
  0852    3A 1860                       LD   A,(1860H) 
  0855    A7                            AND  A 
  0856    28 0F                         JR   Z,L0867 
  0858    DF                            RST  18H 
  0859    8D                            DEFB 0DH+80H 
  085A    ED 5B 185B                    LD   DE,(ARG1) 
  085E    DD E5                         PUSH IX 
  0860    E1                            POP  HL 
  0861    A7                            AND  A 
  0862    ED 52                         SBC  HL,DE 
  0864    D8                            RET  C 
  0865    18 DF                         JR   L0846 
                                ;
  0867    CD 07FA               L0867:  CALL L07FA 
  086A    28 07                         JR   Z,L0873 
  086C    DF                            RST  18H 
  086D    8D                            DEFB 0DH+80H 
  086E    18 D6                         JR   L0846 
                                ;
  0870    CD 0441               L0870:  CALL L0441 
  0873    2A 185D               L0873:  LD   HL,(ARG2) 
  0876    09                            ADD  HL,BC 
  0877    2B                            DEC  HL 
  0878    DF                            RST  18H 
  0879    20                            DEFM " " 
  087A    BC                            DEFB 3CH+80H      ;"<+80H 
  087B    CD 07F1                       CALL L07F1 
  087E    DF                            RST  18H 
  087F    BE                            DEFB 3EH+80H      ;">+80H 
  0880    3A 185F                       LD   A,(ARG3) 
	MACRO-80 3.44	09-Dec-81	PAGE	1-32


  0883    A7                            AND  A 
  0884    20 08                         JR   NZ,L088E 
  0886    DF                            RST  18H 
  0887    20 28 48 29                   DEFM " (H)" 
  088B    A0                            DEFB 20H+80H 
  088C    18 06                         JR   L0894 
                                ;
  088E    DF                    L088E:  RST  18H 
  088F    20 28 41 29                   DEFM " (A)" 
  0893    A0                            DEFB 20H+80H 
  0894    ED 53 1800            L0894:  LD   (KURPOS),DE 
  0898    41                            LD   B,C 
  0899    DF                    L0899:  RST  18H 
  089A    09 09 89                      DEFB 09H,09H,09H+80H 
  089D    10 FA                         DJNZ L0899 
  089F    CD 07FA                       CALL L07FA 
  08A2    FE 8B                         CP   8BH 
  08A4    28 5D                         JR   Z,L0903 
  08A6    CF                    L08A6:  RST  08H 
  08A7    FE 08                         CP   08H 
  08A9    CA 0932                       JP   Z,L0932 
  08AC    FE 03                         CP   03H 
  08AE    28 43                         JR   Z,L08F3 
  08B0    FE 0D                         CP   0DH 
  08B2    28 37                         JR   Z,L08EB 
  08B4    FE 01                         CP   01H 
  08B6    28 41                         JR   Z,L08F9 
  08B8    FE 09                         CP   09H 
  08BA    28 5F                         JR   Z,L091B 
  08BC    FE 0A                         CP   0AH 
  08BE    28 6C                         JR   Z,L092C 
  08C0    FE 0B                         CP   0BH 
  08C2    28 3F                         JR   Z,L0903 
  08C4    FE 20                         CP   20H 
  08C6    38 DE                         JR   C,L08A6 
  08C8    08                            EX   AF,AF' 
  08C9    3A 185F                       LD   A,(ARG3) 
  08CC    A7                            AND  A 
  08CD    20 3C                         JR   NZ,L090B 
  08CF    08                            EX   AF,AF' 
  08D0    CD 0496                       CALL L0496 
  08D3    38 D1                         JR   C,L08A6 
  08D5    06 02                         LD   B,02H 
  08D7    D7                    L08D7:  RST  10H 
  08D8    FE 3A                         CP   3AH 
  08DA    38 02                         JR   C,L08DE 
  08DC    D6 37                         SUB  37H 
  08DE    ED 6F                 L08DE:  RLD 
  08E0    05                            DEC  B 
  08E1    28 2F                         JR   Z,L0912 
  08E3    CF                    L08E3:  RST  08H 
  08E4    CD 0496                       CALL L0496 
  08E7    38 FA                         JR   C,L08E3 
  08E9    18 EC                         JR   L08D7 
                                ;
  08EB    CD 04A4               L08EB:  CALL L04A4 
  08EE    DF                            RST  18H 
  08EF    8D                            DEFB 0DH+80H 
  08F0    C3 0846                       JP   L0846 
                                ;
	MACRO-80 3.44	09-Dec-81	PAGE	1-33


  08F3    DF                    L08F3:  RST  18H 
  08F4    8D                            DEFB 0DH+80H 
  08F5    22 185B                       LD   (ARG1),HL 
  08F8    C9                            RET 
                                ;
  08F9    3A 185F               L08F9:  LD   A,(ARG3) 
  08FC    2F                            CPL 
  08FD    32 185F                       LD   (ARG3),A 
  0900    C3 0870                       JP   L0870 
                                ;
  0903    11 0008               L0903:  LD   DE,0008H 
  0906    A7                            AND  A 
  0907    ED 52                         SBC  HL,DE 
  0909    18 2D                         JR   L0938 
                                ;
  090B    08                    L090B:  EX   AF,AF' 
  090C    CD 0487                       CALL L0487 
  090F    38 95                         JR   C,L08A6 
  0911    77                            LD   (HL),A 
  0912    3E 08                 L0912:  LD   A,08H 
  0914    B9                            CP   C 
  0915    20 04                         JR   NZ,L091B 
  0917    CD 0441                       CALL L0441 
  091A    2B                            DEC  HL 
  091B    0C                    L091B:  INC  C 
  091C    23                            INC  HL 
  091D    3E 09                         LD   A,09H 
  091F    B9                            CP   C 
  0920    20 07                         JR   NZ,L0929 
  0922    0E 01                         LD   C,01H 
  0924    CD 04A4               L0924:  CALL L04A4 
  0927    DF                            RST  18H 
  0928    8A                            DEFB 0AH+80H 
  0929    C3 0870               L0929:  JP   L0870 
                                ;
  092C    11 0008               L092C:  LD   DE,0008H 
  092F    19                            ADD  HL,DE 
  0930    18 F2                         JR   L0924 
                                ;
  0932    2B                    L0932:  DEC  HL 
  0933    0D                            DEC  C 
  0934    20 F3                         JR   NZ,L0929 
  0936    0E 08                         LD   C,08H 
  0938    CD 04A4               L0938:  CALL L04A4 
  093B    ED 5B 1800                    LD   DE,(KURPOS) 
  093F    E5                            PUSH HL 
  0940    21 17BF                       LD   HL,17BFH 
  0943    ED 52                         SBC  HL,DE 
  0945    E1                            POP  HL 
  0946    30 0F                         JR   NC,L0957 
  0948    D9                            EXX 
  0949    21 1040                       LD   HL,1040H 
  094C    11 1000                       LD   DE,1000H 
  094F    01 07C0                       LD   BC,07C0H 
  0952    ED B0                         LDIR 
  0954    D9                            EXX 
  0955    18 D2                         JR   L0929 
                                ;
  0957    DF                    L0957:  RST  18H 
  0958    8B                            DEFB 0BH+80H 
	MACRO-80 3.44	09-Dec-81	PAGE	1-34


  0959    18 CE                         JR   L0929 
                                ;
                                ;
                                ; Funktion "F" --> Find (TODO)
                                ;
  095B    00 09 46 0D                   DEFB 00H,09H,46H,0DH 
  095F    CD 0A61                       CALL L0A61 
  0962    1A                            LD   A,(DE) 
  0963    FE 4A                         CP   4AH 
  0965    28 32                         JR   Z,L0999 
  0967    FE 27                         CP   27H 
  0969    28 02                         JR   Z,L096D 
  096B    18 21                         JR   L098E 
                                ;
  096D    1B                    L096D:  DEC  DE 
  096E    1A                            LD   A,(DE) 
  096F    FE 20                         CP   20H 
  0971    28 0A                         JR   Z,L097D 
  0973    D9                            EXX 
  0974    77                            LD   (HL),A 
  0975    23                            INC  HL 
  0976    3E 01                         LD   A,01H 
  0978    12                            LD   (DE),A 
  0979    13                            INC  DE 
  097A    D9                            EXX 
  097B    18 F0                         JR   L096D 
                                ;
  097D    1B                    L097D:  DEC  DE 
  097E    1A                            LD   A,(DE) 
  097F    FE 4A                         CP   4AH 
  0981    28 16                         JR   Z,L0999 
  0983    FE 27                         CP   27H 
  0985    28 E6                         JR   Z,L096D 
  0987    FE 20                         CP   20H 
  0989    28 17                         JR   Z,L09A2 
  098B    CD 07F7                       CALL L07F7 
  098E    7D                    L098E:  LD   A,L 
  098F    D9                            EXX 
  0990    77                            LD   (HL),A 
  0991    23                            INC  HL 
  0992    3E 01                         LD   A,01H 
  0994    12                            LD   (DE),A 
  0995    13                            INC  DE 
  0996    D9                            EXX 
  0997    18 E4                         JR   L097D 
                                ;
  0999    D9                    L0999:  EXX 
  099A    23                            INC  HL 
  099B    AF                            XOR  A 
  099C    12                            LD   (DE),A 
  099D    13                            INC  DE 
  099E    D9                            EXX 
  099F    1B                            DEC  DE 
  09A0    18 DB                         JR   L097D 
                                ;
  09A2    D9                    L09A2:  EXX 
  09A3    3E FF                         LD   A,0FFH
  09A5    12                            LD   (DE),A 
  09A6    D9                            EXX 
  09A7    CD 04CA                       CALL ARGLD        ;ARG1-->HL ARG2-->DE ARG3-->BC 
	MACRO-80 3.44	09-Dec-81	PAGE	1-35


  09AA    01 0164                       LD   BC,0164H 
  09AD    CD 0A61               L09AD:  CALL L0A61 
  09B0    CD 04AD                       CALL L04AD 
  09B3    F5                    L09B3:  PUSH AF 
  09B4    A7                            AND  A 
  09B5    E5                            PUSH HL 
  09B6    ED 52                         SBC  HL,DE 
  09B8    E1                            POP  HL 
  09B9    30 09                         JR   NC,L09C4 
  09BB    F1                            POP  AF 
  09BC    28 20                         JR   Z,L09DE 
  09BE    BE                            CP   (HL) 
  09BF    28 1D                         JR   Z,L09DE 
  09C1    23                            INC  HL 
  09C2    18 EF                         JR   L09B3 
                                ;
  09C4    F1                    L09C4:  POP  AF 
  09C5    CD 0A61               L09C5:  CALL L0A61 
  09C8    D9                            EXX 
  09C9    CD 0A6A                       CALL L0A6A 
  09CC    05                            DEC  B 
  09CD    C2 09DB                       JP   NZ,L09DB 
  09D0    DF                            RST  18H 
  09D1    20 4E 6F 74                   DEFM " Not foun" 
  09D5    20 66 6F 75           
  09D9    6E                    
  09DA    E4                            DEFB 64H+80H      ;"d+80H 
  09DB    DF                    L09DB:  RST  18H 
  09DC    8D                            DEFB 0DH+80H 
  09DD    C9                            RET 
                                ;
  09DE    E5                    L09DE:  PUSH HL 
  09DF    DD E1                         POP  IX 
  09E1    3E 18                         LD   A,18H 
  09E3    BC                            CP   H 
  09E4    20 05                         JR   NZ,L09EB 
  09E6    3E D0                         LD   A,0D0H
  09E8    BD                            CP   L 
  09E9    28 0B                         JR   Z,L09F6 
  09EB    23                    L09EB:  INC  HL 
  09EC    CD 04AD                       CALL L04AD 
  09EF    28 FA                         JR   Z,L09EB 
  09F1    30 09                         JR   NC,L09FC 
  09F3    BE                            CP   (HL) 
  09F4    28 F5                         JR   Z,L09EB 
  09F6    DD E5                 L09F6:  PUSH IX 
  09F8    E1                            POP  HL 
  09F9    23                            INC  HL 
  09FA    18 B1                         JR   L09AD 
                                ;
  09FC    DD E5                 L09FC:  PUSH IX 
  09FE    E1                            POP  HL 
  09FF    AF                            XOR  A 
  0A00    80                            ADD  A,B 
  0A01    28 03                         JR   Z,L0A06 
  0A03    22 185B                       LD   (ARG1),HL 
  0A06    DF                    L0A06:  RST  18H 
  0A07    A0                            DEFB 20H+80H 
  0A08    CD 019A                       CALL OUTHL 
  0A0B    DF                            RST  18H 
	MACRO-80 3.44	09-Dec-81	PAGE	1-36


  0A0C    BA                            DEFB 3AH+80H      ;":+80H 
  0A0D    06 04                         LD   B,04H 
  0A0F    7E                    L0A0F:  LD   A,(HL) 
  0A10    CD 0183                       CALL OUTHEX 
  0A13    23                            INC  HL 
  0A14    10 F9                         DJNZ L0A0F 
  0A16    DF                            RST  18H 
  0A17    20                            DEFM " " 
  0A18    A0                            DEFB 20H+80H 
  0A19    DD E5                         PUSH IX 
  0A1B    E1                            POP  HL 
  0A1C    23                            INC  HL 
  0A1D    0D                            DEC  C 
  0A1E    20 8D                         JR   NZ,L09AD 
  0A20    CF                            RST  08H 
  0A21    FE 51                         CP   51H 
  0A23    28 A0                         JR   Z,L09C5 
  0A25    0E 64                         LD   C,64H 
  0A27    18 84                         JR   L09AD 
                                ;
  0A29                                  DEFS 2,0FFH       ;Platzhalter 2 Byte
                                ;
  0A2B    2A 185B               L0A2B:  LD   HL,(ARG1) 
  0A2E    CA 0DF0                       JP   Z,L0DF0 
  0A31    DB 05                 L0A31:  IN   A,(P05) 
  0A33    CB AF                         RES  5,A 
  0A35    18 05                         JR   L0A3C 
                                ;
  0A37    DB 05                 L0A37:  IN   A,(P05) 
  0A39    CB EF                         SET  5,A 
  0A3B    F3                            DI 
  0A3C    DF                    L0A3C:  RST  18H 
  0A3D    87                            DEFB 07H+80H 
  0A3E    D3 05                         OUT  (P05),A 
  0A40    C9                            RET 
                                ;
                                ;
                                ; Funktion "H" --> I/O-Byte anzeigen / setzen
                                ;
  0A41    00 09 48 0D                   DEFB 00H,09H,48H,0DH 
  0A45    DF                            RST  18H 
  0A46    20 49 2F 4F                   DEFM " I/O Byte" 
  0A4A    20 42 79 74           
  0A4E    65                    
  0A4F    A0                            DEFB 20H+80H 
  0A50    11 1821                       LD   DE,IOBYTE    ;Speicherplatz vom I/O-Byte 
  0A53    1A                            LD   A,(DE)
  0A54    CD 0183                       CALL OUTHEX       ;Bildschirmausgabe I/O-Byte
  0A57    13                            INC  DE 
  0A58    C3 067E                       JP   INHEX4       ;Eingabe pruefen und I/O-Byte setzen
                                ;
  0A5B    CD 0404               L0A5B:  CALL L0404 
  0A5E    C3 0A31                       JP   L0A31 
                                ;
  0A61    D9                    L0A61:  EXX 
  0A62    21 18D0                       LD   HL,18D0H 
  0A65    11 18E8                       LD   DE,18E8H 
  0A68    D9                            EXX 
  0A69    C9                            RET 
                                ;
	MACRO-80 3.44	09-Dec-81	PAGE	1-37


  0A6A    71                    L0A6A:  LD   (HL),C 
  0A6B    E5                            PUSH HL 
  0A6C    AF                            XOR  A 
  0A6D    EB                            EX   DE,HL 
  0A6E    ED 52                         SBC  HL,DE 
  0A70    44                            LD   B,H 
  0A71    4D                            LD   C,L 
  0A72    E1                            POP  HL 
  0A73    1B                            DEC  DE 
  0A74    ED B0                         LDIR 
  0A76    D9                            EXX 
  0A77    C9                            RET 
                                ;
  0A78                                  DEFS 3,0FFH       ;Platzhalter 3 Byte
                                ;
  0A7B    21 023A               L0A7B:  LD   HL,023AH 
  0A7E    06 03                         LD   B,03H 
  0A80    1A                    L0A80:  LD   A,(DE) 
  0A81    BE                            CP   (HL) 
  0A82    C0                            RET  NZ 
  0A83    23                            INC  HL 
  0A84    13                            INC  DE 
  0A85    10 F9                         DJNZ L0A80 
  0A87    1A                            LD   A,(DE) 
  0A88    6F                            LD   L,A 
  0A89    13                            INC  DE 
  0A8A    1A                            LD   A,(DE) 
  0A8B    67                            LD   H,A 
  0A8C    C9                            RET 
                                ;
                                ;
                                ; Einsprungpunkt fuer RST 18H   (Zeichenkettenausgabe)
                                ; ---------------------------
                                ;
  0A8D    E3                    RST18:  EX   (SP),HL 
  0A8E    F5                            PUSH AF 
  0A8F    7E                    RST18A: LD   A,(HL) 
  0A90    23                            INC  HL 
  0A91    D7                            RST  10H 
  0A92    07                            RLCA 
  0A93    30 FA                         JR   NC,RST18A 
  0A95    F1                            POP  AF 
  0A96    E3                            EX   (SP),HL 
  0A97    C9                            RET 
                                ;
                                ;
                                ; ??? (TODO)
                                ;
  0A98    D3 05                         OUT  (P05),A 
  0A9A    C9                            RET 
                                ;
  0A9B                                  DEFS 4,0FFH       ;Platzhalter 4 Byte
                                ;
                                ; Funktion "I" --> Initialize
                                ;
  0A9F    00 09 49 0D                   DEFB 00H,09H,49H,0DH 
  0AA3    21 1858                       LD   HL,1858H 
  0AA6    06 26                         LD   B,26H 
  0AA8    36 00                 INIRSA: LD   (HL),00H     ;RAM-Zellen von 1858H bis 187DH
  0AAA    23                            INC  HL           ;mit 00H beschreiben
	MACRO-80 3.44	09-Dec-81	PAGE	1-38


  0AAB    10 FB                         DJNZ INIRSA 
  0AAD    DF                            RST  18H 
  0AAE    20 53 50                      DEFM " SP"        ;= Stack Pointer
  0AB1    A0                            DEFB 20H+80H 
  0AB2    CD 0ACE                       CALL UPRAMT       ;HL = letzte RAM-Zelle + 1
  0AB5    22 1877                       LD   (1877H),HL   ;Anwenderstack festlegen
  0AB8    18 10                         JR   OUTHL3       ;HEX-Adresse auf BS ausgeben
                                ;
                                ;
                                ; Funktion "O" --> RAM-Test
                                ;
  0ABA    00 09 4F 0D                   DEFB 00H,09H,4FH,0DH 
  0ABE    2A 185B                       LD   HL,(ARG1)    ;ARG1 laden
  0AC1    DF                            RST  18H 
  0AC2    20 4D 45                      DEFM " ME"        ;= Memory End
  0AC5    A0                            DEFB 20H+80H 
  0AC6    CD 0ACE                       CALL UPRAMT       ;UP RAM-Test
  0AC9    2B                            DEC  HL           ;Adresse der letzten RAM-Zelle
  0ACA    C3 019A               OUTHL3: JP   OUTHL        ;auf BS ausgeben
                                ;
  0ACD    FF                            DEFB 0FFH         ;Platzhalter 1 Byte
                                ;
                                ; UP RAM-Test
                                ;
  0ACE    7E                    UPRAMT: LD   A,(HL) 
  0ACF    2F                            CPL               ;Akku bitweise negieren
  0AD0    77                            LD   (HL),A       ;Komplement zurueckschreiben
  0AD1    BE                            CP   (HL) 
  0AD2    C0                            RET  NZ           ;Abbruch bei Fehler
  0AD3    2F                            CPL               ;Akku bitweise negieren
  0AD4    77                            LD   (HL),A       ;Originalwert zurueckschreiben
  0AD5    23                            INC  HL           ;naechste Speicheradresse
  0AD6    18 F6                         JR   UPRAMT       ;LOOP
                                ;
                                ;
                                ; Tabelle fuer IO-Befehle (17x Port, Befehl, Port, Befehl, ...)
                                ;
  0AD8    00 F8 01 37           TABIO:  DEFB 00H,0F8H,01H,37H
  0ADC    01 4E 02 47                   DEFB 01H,4EH,02H,47H
  0AE0    02 32 0B CF                   DEFB 02H,32H,0BH,0CFH
  0AE4    0B 00 0A CF                   DEFB 0BH,00H,0AH,0CFH
  0AE8    0A C5 08 0A                   DEFB 0AH,0C5H,08H,0AH
  0AEC    06 CF 06 FF                   DEFB 06H,0CFH,06H,0FFH
  0AF0    06 07 07 CF                   DEFB 06H,07H,07H,0CFH
  0AF4    07 84 07 07                   DEFB 07H,84H,07H,07H
  0AF8    14 00 FF                      DEFB 14H,00H,0FFH
                                ;
                                ;
                                ; Funktion "K" --> Kassette save (TODO)
                                ;
  0AFB    00 09 4B 0D                   DEFB 00H,09H,4BH,0DH 
  0AFF    CD 0B97                       CALL L0B97 
  0B02    CD 0A37                       CALL L0A37 
  0B05    2B                            DEC  HL 
  0B06    22 187E                       LD   (187EH),HL 
  0B09    21 1896                       LD   HL,1896H 
  0B0C    22 1880                       LD   (1880H),HL 
  0B0F    CD 0BE1                       CALL L0BE1 
  0B12    CD 0BF7                       CALL L0BF7 
  0B15    11 187E                       LD   DE,187EH 
	MACRO-80 3.44	09-Dec-81	PAGE	1-39


  0B18    21 18B1                       LD   HL,18B1H 
  0B1B    01 0004                       LD   BC,0004H 
  0B1E    ED B0                         LDIR 
  0B20    CD 0BF7                       CALL L0BF7 
  0B23    C3 0A5B                       JP   L0A5B 
                                ;
                                ;
                                ; Funktion "Z" --> Kassette verify (TODO)
                                ;
  0B26    00 09 5A 0D                   DEFB 00H,09H,5AH,0DH 
  0B2A    AF                            XOR  A 
  0B2B    3D                            DEC  A 
  0B2C    18 05                         JR   L0B33 
                                ;
                                ;
                                ; Funktion "L" --> Kassette load (TODO)
                                ;
  0B2E    00 09 4C 0D                   DEFB 00H,09H,4CH,0DH 
  0B32    82                            ADD  A,D 
  0B33    08                    L0B33:  EX   AF,AF' 
  0B34    CD 0B97                       CALL L0B97 
  0B37    CD 0A37                       CALL L0A37 
  0B3A    22 1880                       LD   (1880H),HL 
  0B3D    21 18D5                       LD   HL,18D5H 
  0B40    22 187E                       LD   (187EH),HL 
  0B43    CD 0BE1               L0B43:  CALL L0BE1 
  0B46    CD 0C81               L0B46:  CALL L0C81 
  0B49    21 18B6                       LD   HL,18B6H 
  0B4C    11 1896                       LD   DE,1896H 
  0B4F    06 08                         LD   B,08H 
  0B51    1A                    L0B51:  LD   A,(DE) 
  0B52    BE                            CP   (HL) 
  0B53    20 F1                         JR   NZ,L0B46 
  0B55    23                            INC  HL 
  0B56    13                            INC  DE 
  0B57    10 F8                         DJNZ L0B51 
  0B59    06 13                         LD   B,13H 
  0B5B    1A                    L0B5B:  LD   A,(DE) 
  0B5C    BE                            CP   (HL) 
  0B5D    28 04                         JR   Z,L0B63 
  0B5F    FE 20                         CP   20H 
  0B61    20 22                         JR   NZ,L0B85 
  0B63    23                    L0B63:  INC  HL 
  0B64    13                            INC  DE 
  0B65    10 F4                         DJNZ L0B5B 
  0B67    1E 7E                         LD   E,7EH 
  0B69    0E 04                         LD   C,04H 
  0B6B    ED B0                         LDIR 
  0B6D    21 0DB7                       LD   HL,0DB7H 
  0B70    08                            EX   AF,AF' 
  0B71    3C                            INC  A 
  0B72    28 02                         JR   Z,L0B76 
  0B74    2E BD                         LD   L,0BDH
  0B76    08                    L0B76:  EX   AF,AF' 
  0B77    CD 0D86                       CALL L0D86 
  0B7A    CD 0C81                       CALL L0C81 
  0B7D    CD 0DC9                       CALL L0DC9 
  0B80    DF                            RST  18H 
  0B81    8D                            DEFB 0DH+80H 
  0B82    C3 0A2B                       JP   L0A2B 
	MACRO-80 3.44	09-Dec-81	PAGE	1-40


                                ;
  0B85    CD 0DC9               L0B85:  CALL L0DC9 
  0B88    20 B9                         JR   NZ,L0B43 
  0B8A    CD 0D83                       CALL L0D83 
  0B8D    18 B4                         JR   L0B43 
                                ;
  0B8F    FF                            DEFB 0FFH         ;Platzhalter 1 Byte
                                ;
                                        IFDEF MONI88      ;Monitor 10/88 - Originalversion 1988
                                ;
                                ; UP 'Zeitschleife 18 ms' zur Tastaturentprellung
                                ; -----------------------------------------------
                                ;
  0B90    C5                            PUSH BC
  0B91    01 0481                       LD   BC,0481H     ;Zeitkonstante fuer 18ms
  0B94    C3 0121                       JP   MS30A
                                ;
                                        ENDIF
                                        IFDEF MONI88A     ;Monitor 10/88 - Originalversion mit Anpassungen
                                ;
                                ; UP 'Zeitschleife 18 ms' zur Tastaturentprellung
                                ; -----------------------------------------------
                                ;
                                        PUSH BC
                                        LD   BC,0481H     ;Zeitkonstante fuer 18ms
                                        JP   MS30A
                                ;
                                        ENDIF
                                        IFDEF MONI11      ;Monitor 10/88 - BWS-CPLD-Version 2011
                                ;
                                ; die Zeitschleife gibt es im Moni 2011 nicht mehr ...
                                ;
                                        DEFB 0FFH
                                        DEFB 0FFH,0FFH,0FFH
                                        DEFB 0FFH,0FFH,0FFH
                                ;
                                        ENDIF
                                        IFDEF MONI11A     ;Monitor 10/88 - BWS-CPLD-Version mit Anpassungen
                                ;
                                ; die Zeitschleife gibt es im Moni 2021 nicht mehr ...
                                ;
                                        DEFB 0FFH
                                        DEFB 0FFH,0FFH,0FFH
                                        DEFB 0FFH,0FFH,0FFH
                                ;
                                        ENDIF
                                ;
                                ;
  0B97    2A 185D               L0B97:  LD   HL,(ARG2) 
  0B9A    22 18B1                       LD   (18B1H),HL 
  0B9D    2A 185B                       LD   HL,(ARG1) 
  0BA0    22 18B3                       LD   (18B3H),HL 
  0BA3    0E 50                         LD   C,50H 
  0BA5    1A                    L0BA5:  LD   A,(DE) 
  0BA6    FE 3A                         CP   3AH 
  0BA8    1B                            DEC  DE 
  0BA9    28 FA                         JR   Z,L0BA5 
  0BAB    FE 2A                         CP   2AH 
  0BAD    20 04                         JR   NZ,L0BB3 
  0BAF    1A                            LD   A,(DE) 
	MACRO-80 3.44	09-Dec-81	PAGE	1-41


  0BB0    1B                            DEC  DE 
  0BB1    0E 44                         LD   C,44H 
  0BB3    FE 22                 L0BB3:  CP   22H 
  0BB5    21 1896                       LD   HL,1896H 
  0BB8    06 08                         LD   B,08H 
  0BBA    36 4E                 L0BBA:  LD   (HL),4EH 
  0BBC    23                            INC  HL 
  0BBD    10 FB                         DJNZ L0BBA 
  0BBF    06 10                         LD   B,10H 
  0BC1    20 0C                         JR   NZ,L0BCF 
  0BC3    1A                    L0BC3:  LD   A,(DE) 
  0BC4    FE 22                         CP   22H 
  0BC6    28 07                         JR   Z,L0BCF 
  0BC8    77                            LD   (HL),A 
  0BC9    1B                            DEC  DE 
  0BCA    23                            INC  HL 
  0BCB    10 F6                         DJNZ L0BC3 
  0BCD    18 05                         JR   L0BD4 
                                ;
  0BCF    36 20                 L0BCF:  LD   (HL),20H 
  0BD1    23                            INC  HL 
  0BD2    10 FB                         DJNZ L0BCF 
  0BD4    36 3A                 L0BD4:  LD   (HL),3AH 
  0BD6    23                            INC  HL 
  0BD7    36 20                         LD   (HL),20H 
  0BD9    23                            INC  HL 
  0BDA    71                            LD   (HL),C 
  0BDB    2E B5                         LD   L,0B5H
  0BDD    36 4C                         LD   (HL),4CH 
  0BDF    23                            INC  HL 
  0BE0    C9                            RET 
                                ;
  0BE1    DF                    L0BE1:  RST  18H 
  0BE2    8D                            DEFB 0DH+80H 
  0BE3    21 0DB1                       LD   HL,0DB1H 
  0BE6    DF                    L0BE6:  RST  18H 
  0BE7    0E                            DEFB 0EH 
  0BE8    33 31                         DEFM "31" 
  0BEA    91                            DEFB 11H+80H 
  0BEB    06 06                         LD   B,06H 
  0BED    7E                    L0BED:  LD   A,(HL) 
  0BEE    D7                            RST  10H 
  0BEF    23                            INC  HL 
  0BF0    10 FB                         DJNZ L0BED 
  0BF2    DF                            RST  18H 
  0BF3    20                            DEFM " " 
  0BF4    10 A0                         DEFB 10H,0A0H 
  0BF6    C9                            RET 
                                ;
  0BF7    2A 1880               L0BF7:  LD   HL,(1880H) 
  0BFA    CD 0C0B                       CALL L0C0B 
  0BFD    EB                    L0BFD:  EX   DE,HL 
  0BFE    2A 187E                       LD   HL,(187EH) 
  0C01    A7                            AND  A 
  0C02    ED 52                         SBC  HL,DE 
  0C04    EB                            EX   DE,HL 
  0C05    D8                            RET  C 
  0C06    CD 0C10                       CALL L0C10 
  0C09    18 F2                         JR   L0BFD 
                                ;
	MACRO-80 3.44	09-Dec-81	PAGE	1-42


  0C0B    11 07D0               L0C0B:  LD   DE,07D0H 
  0C0E    18 03                         JR   L0C13 
                                ;
  0C10    11 000E               L0C10:  LD   DE,000EH 
  0C13    06 48                 L0C13:  LD   B,48H 
  0C15    10 FE                 L0C15:  DJNZ L0C15 
  0C17    CD 0C7A                       CALL L0C7A 
  0C1A    1B                            DEC  DE 
  0C1B    7B                            LD   A,E 
  0C1C    B2                            OR   D 
  0C1D    20 F4                         JR   NZ,L0C13 
  0C1F    0E 02                         LD   C,02H 
  0C21    06 21                 L0C21:  LD   B,21H 
  0C23    10 FE                 L0C23:  DJNZ L0C23 
  0C25    CD 0C7A                       CALL L0C7A 
  0C28    0D                            DEC  C 
  0C29    5D                            LD   E,L 
  0C2A    54                            LD   D,H 
  0C2B    20 F4                         JR   NZ,L0C21 
  0C2D    00                            NOP 
  0C2E    D5                            PUSH DE 
  0C2F    DD E1                         POP  IX 
  0C31    06 08                         LD   B,08H 
  0C33    10 FE                 L0C33:  DJNZ L0C33 
  0C35    CD 0C59                       CALL L0C59 
  0C38    06 05                         LD   B,05H 
  0C3A    10 FE                 L0C3A:  DJNZ L0C3A 
  0C3C    0E 10                         LD   C,10H 
  0C3E    5E                    L0C3E:  LD   E,(HL) 
  0C3F    23                            INC  HL 
  0C40    56                            LD   D,(HL) 
  0C41    DD 19                         ADD IX,DE 
  0C43    23                            INC  HL 
  0C44    C5                            PUSH BC 
  0C45    CD 0C59                       CALL L0C59 
  0C48    C1                            POP  BC 
  0C49    0D                            DEC  C 
  0C4A    28 06                         JR   Z,L0C52 
  0C4C    06 03                         LD   B,03H 
  0C4E    10 FE                 L0C4E:  DJNZ L0C4E 
  0C50    18 EC                         JR   L0C3E 
                                ;
  0C52    DD E5                 L0C52:  PUSH IX 
  0C54    D1                            POP  DE 
  0C55    06 07                         LD   B,07H 
  0C57    10 FE                 L0C57:  DJNZ L0C57 
  0C59    0E 10                 L0C59:  LD   C,10H 
  0C5B    CB 3A                 L0C5B:  SRL  D 
  0C5D    CB 1B                         RR   E 
  0C5F    30 07                         JR   NC,L0C68 
  0C61    06 03                         LD   B,03H 
  0C63    10 FE                 L0C63:  DJNZ L0C63 
  0C65    00                            NOP 
  0C66    18 03                         JR   L0C6B 
                                ;
  0C68    CD 0C7A               L0C68:  CALL L0C7A 
  0C6B    06 0F                 L0C6B:  LD   B,0FH 
  0C6D    10 FE                 L0C6D:  DJNZ L0C6D 
  0C6F    CD 0C7A                       CALL L0C7A 
  0C72    0D                            DEC  C 
	MACRO-80 3.44	09-Dec-81	PAGE	1-43


  0C73    C8                            RET  Z 
  0C74    06 0B                         LD   B,0BH 
  0C76    10 FE                 L0C76:  DJNZ L0C76 
  0C78    18 E1                         JR   L0C5B 
                                ;
  0C7A    DB 05                 L0C7A:  IN   A,(P05) 
  0C7C    EE 40                         XOR  40H 
  0C7E    D3 05                         OUT  (P05),A 
  0C80    C9                            RET 
                                ;
  0C81    FD 21 1882            L0C81:  LD   IY,1882H 
  0C85    2A 1880                       LD   HL,(1880H) 
  0C88    D9                            EXX 
  0C89    21 0100                       LD   HL,0100H 
  0C8C    D9                            EXX 
  0C8D    CD 0CBD               L0C8D:  CALL L0CBD 
  0C90    D9                            EXX 
  0C91    20 06                         JR   NZ,L0C99 
  0C93    25                            DEC  H 
  0C94    26 01                         LD   H,01H 
  0C96    28 14                         JR   Z,L0CAC 
  0C98    2C                            INC  L 
  0C99    26 01                 L0C99:  LD   H,01H 
  0C9B    D9                            EXX 
  0C9C    FD 75 00                      LD   (IY+00H),L 
  0C9F    FD 74 01                      LD   (IY+01H),H 
  0CA2    FD 23                         INC  IY 
  0CA4    FD 23                         INC  IY
  0CA6    FD 7D                         DEFB 0FDH,7DH     ;= undokumentierter Befehl LD A,IYL
  0CA8    D6 94                         SUB  94H 
  0CAA    C8                            RET  Z 
  0CAB    D9                            EXX 
  0CAC    D9                    L0CAC:  EXX 
  0CAD    EB                            EX   DE,HL 
  0CAE    2A 187E                       LD   HL,(187EH) 
  0CB1    A7                            AND  A 
  0CB2    ED 52                         SBC  HL,DE 
  0CB4    EB                            EX   DE,HL 
  0CB5    D8                            RET  C 
  0CB6    18 D5                         JR   L0C8D 
                                ;
  0CB8                                  DEFS 5,0FFH       ;Platzhalter 5 Byte
                                ;
  0CBD    CD 0D5A               L0CBD:  CALL L0D5A 
  0CC0    CD 0D52                       CALL L0D52 
  0CC3    0E 07                         LD   C,07H 
  0CC5    11 060B               L0CC5:  LD   DE,060BH 
  0CC8    3E 02                         LD   A,02H 
  0CCA    3D                    L0CCA:  DEC  A 
  0CCB    20 FD                         JR   NZ,L0CCA 
  0CCD    CD 0D5A                       CALL L0D5A 
  0CD0    CD 0D5A               L0CD0:  CALL L0D5A 
  0CD3    20 E8                         JR   NZ,L0CBD 
  0CD5    15                            DEC  D 
  0CD6    20 F8                         JR   NZ,L0CD0 
  0CD8    0D                            DEC  C 
  0CD9    28 0C                         JR   Z,L0CE7 
  0CDB    DB 05                 L0CDB:  IN   A,(P05) 
  0CDD    A8                            XOR  B 
  0CDE    CB 7F                         BIT  7,A 
	MACRO-80 3.44	09-Dec-81	PAGE	1-44


  0CE0    20 E3                         JR   NZ,L0CC5 
  0CE2    1D                            DEC  E 
  0CE3    20 F6                         JR   NZ,L0CDB 
  0CE5    18 D6                         JR   L0CBD 
                                ;
  0CE7    CD 0D52               L0CE7:  CALL L0D52 
  0CEA    3E 2C                         LD   A,2CH 
  0CEC    3D                    L0CEC:  DEC  A 
  0CED    20 FD                         JR   NZ,L0CEC 
  0CEF    CD 0D5A                       CALL L0D5A 
  0CF2    20 F3                         JR   NZ,L0CE7 
  0CF4    CD 0D52                       CALL L0D52 
  0CF7    3E 12                         LD   A,12H 
  0CF9    3D                    L0CF9:  DEC  A 
  0CFA    20 FD                         JR   NZ,L0CF9 
  0CFC    CD 0D64                       CALL L0D64 
  0CFF    0E 10                         LD   C,10H 
  0D01    D5                            PUSH DE 
  0D02    DD E1                         POP  IX 
  0D04    3E 0D                         LD   A,0DH 
  0D06    3D                    L0D06:  DEC  A 
  0D07    20 FD                         JR   NZ,L0D06 
  0D09    CD 0D64               L0D09:  CALL L0D64 
  0D0C    DD 19                         ADD IX,DE 
  0D0E    C5                            PUSH BC 
  0D0F    4D                            LD   C,L 
  0D10    44                            LD   B,H 
  0D11    2A 187E                       LD   HL,(187EH) 
  0D14    AF                            XOR  A 
  0D15    ED 42                         SBC  HL,BC 
  0D17    69                            LD   L,C 
  0D18    60                            LD   H,B 
  0D19    C1                            POP  BC 
  0D1A    38 16                         JR   C,L0D32 
  0D1C    08                            EX   AF,AF' 
  0D1D    28 04                         JR   Z,L0D23 
  0D1F    73                            LD   (HL),E 
  0D20    23                            INC  HL 
  0D21    72                            LD   (HL),D 
  0D22    2B                            DEC  HL 
  0D23    08                    L0D23:  EX   AF,AF' 
  0D24    7B                            LD   A,E 
  0D25    BE                            CP   (HL) 
  0D26    23                            INC  HL 
  0D27    7A                            LD   A,D 
  0D28    20 03                         JR   NZ,L0D2D 
  0D2A    BE                            CP   (HL) 
  0D2B    28 0B                         JR   Z,L0D38 
  0D2D    D9                    L0D2D:  EXX 
  0D2E    24                            INC  H 
  0D2F    D9                            EXX 
  0D30    18 06                         JR   L0D38 
                                ;
  0D32    3E 04                 L0D32:  LD   A,04H 
  0D34    3D                    L0D34:  DEC  A 
  0D35    20 FD                         JR   NZ,L0D34 
  0D37    2B                            DEC  HL 
  0D38    23                    L0D38:  INC  HL 
  0D39    3E 02                         LD   A,02H 
  0D3B    3D                    L0D3B:  DEC  A 
	MACRO-80 3.44	09-Dec-81	PAGE	1-45


  0D3C    20 FD                         JR   NZ,L0D3B 
  0D3E    0D                            DEC  C 
  0D3F    20 C8                         JR   NZ,L0D09 
  0D41    CD 0D64                       CALL L0D64 
  0D44    EB                            EX   DE,HL 
  0D45    DD E5                         PUSH IX 
  0D47    C1                            POP  BC 
  0D48    AF                            XOR  A 
  0D49    ED 42                         SBC  HL,BC 
  0D4B    EB                            EX   DE,HL 
  0D4C    C9                            RET 
                                ;
  0D4D    CD 0297               TASTE:  CALL UPTAST       ;Taste gedrueckt?
  0D50    18 5B                         JR   L0DAD 
                                ;
  0D52    DB 05                 L0D52:  IN   A,(P05) 
  0D54    A8                            XOR  B 
  0D55    CB 7F                         BIT  7,A 
  0D57    28 F9                         JR   Z,L0D52 
  0D59    C9                            RET 
                                ;
  0D5A    DB 05                 L0D5A:  IN   A,(P05) 
  0D5C    A8                            XOR  B 
  0D5D    CB 7F                         BIT  7,A 
  0D5F    F5                            PUSH AF 
  0D60    A8                            XOR  B 
  0D61    47                            LD   B,A 
  0D62    F1                            POP  AF 
  0D63    C9                            RET 
                                ;
  0D64    E5                    L0D64:  PUSH HL 
  0D65    2E 10                         LD   L,10H 
  0D67    CD 0D5A               L0D67:  CALL L0D5A 
  0D6A    20 03                         JR   NZ,L0D6F 
  0D6C    AF                            XOR  A 
  0D6D    18 01                         JR   L0D70 
                                ;
  0D6F    37                    L0D6F:  SCF 
  0D70    CB 1A                 L0D70:  RR   D 
  0D72    CB 1B                         RR   E 
  0D74    CD 0D52                       CALL L0D52 
  0D77    2D                            DEC  L 
  0D78    28 07                         JR   Z,L0D81 
  0D7A    3E 12                         LD   A,12H 
  0D7C    3D                    L0D7C:  DEC  A 
  0D7D    20 FD                         JR   NZ,L0D7C 
  0D7F    18 E6                         JR   L0D67 
                                ;
  0D81    E1                    L0D81:  POP  HL 
  0D82    C9                            RET 
                                ;
  0D83    21 0DC3               L0D83:  LD   HL,0DC3H 
  0D86    CD 0BE6               L0D86:  CALL L0BE6 
  0D89    21 18BE                       LD   HL,18BEH 
  0D8C    06 13                         LD   B,13H 
  0D8E    7E                    L0D8E:  LD   A,(HL) 
  0D8F    D7                            RST  10H 
  0D90    23                            INC  HL 
  0D91    10 FB                         DJNZ L0D8E 
  0D93    DF                            RST  18H 
	MACRO-80 3.44	09-Dec-81	PAGE	1-46


  0D94    20 20 20                      DEFM "   " 
  0D97    A0                            DEFB 20H+80H 
  0D98    2A 18D3                       LD   HL,(18D3H) 
  0D9B    22 185B                       LD   (ARG1),HL 
  0D9E    CD 019A                       CALL OUTHL 
  0DA1    DF                            RST  18H 
  0DA2    20                            DEFM " " 
  0DA3    A0                            DEFB 20H+80H 
  0DA4    2A 18D1                       LD   HL,(18D1H) 
  0DA7    22 185D                       LD   (ARG2),HL 
  0DAA    C3 019A                       JP   OUTHL 
                                ;
  0DAD    C8                    L0DAD:  RET  Z 
  0DAE    CB FF                         SET  7,A 
  0DB0    C9                            RET 
                                ;
                                ;
                                ; Texte fuer Kassettenarbeit
                                ;
  0DB1    57 41 52 54                   DEFM "WARTEN"
  0DB5    45 4E                 
  0DB7    56 45 52 49                   DEFM "VERIFY"
  0DBB    46 59                 
  0DBD    4C 41 44 45                   DEFM "LADEN "
  0DC1    4E 20                 
  0DC3    46 4F 55 4E                   DEFM "FOUND "
  0DC7    44 20                 
                                ;
                                ;
                                ; ??? (TODO)
                                ;
  0DC9    11 1882               L0DC9:  LD   DE,1882H
  0DCC    FD 7D                         DEFB 0FDH,7DH     ;= undokumentierter Befehl LD A,IYL
  0DCE    93                            SUB  E 
  0DCF    C8                            RET  Z 
  0DD0    DF                            RST  18H 
  0DD1    8D                            DEFB 0DH+80H 
  0DD2    CD 0268                       CALL ERROR 
  0DD5    0F                            RRCA 
  0DD6    47                            LD   B,A 
  0DD7    D9                            EXX 
  0DD8    95                            SUB  L 
  0DD9    D9                            EXX 
  0DDA    20 05                         JR   NZ,L0DE1 
  0DDC    DF                            RST  18H 
  0DDD    52 41 4D                      DEFM "RAM" 
  0DE0    BA                            DEFB 3AH+80H      ;":+80H 
  0DE1    1A                    L0DE1:  LD   A,(DE) 
  0DE2    13                            INC  DE 
  0DE3    6F                            LD   L,A 
  0DE4    1A                            LD   A,(DE) 
  0DE5    13                            INC  DE 
  0DE6    67                            LD   H,A 
  0DE7    DF                            RST  18H 
  0DE8    A0                            DEFB 20H+80H 
  0DE9    CD 019A                       CALL OUTHL 
  0DEC    10 F3                         DJNZ L0DE1 
  0DEE    05                            DEC  B 
  0DEF    C9                            RET 
                                ;
	MACRO-80 3.44	09-Dec-81	PAGE	1-47


  0DF0    CD 0A31               L0DF0:  CALL L0A31 
  0DF3    EB                            EX   DE,HL 
  0DF4    CD 0A7B                       CALL L0A7B 
  0DF7    C0                            RET  NZ 
  0DF8    E9                            JP   (HL) 
                                ;
                                ;
                                ; V.24 - Ausgabe UP
                                ; -----------------
                                ;
  0DF9    E5                    V24OUT: PUSH HL 
  0DFA    D5                            PUSH DE 
  0DFB    C5                            PUSH BC 
  0DFC    F5                            PUSH AF 
  0DFD    21 1820                       LD   HL,V24REG    ;V.24-Kontrollregister
  0E00    01 7FFF                       LD   BC,7FFFH 
  0E03    CB 66                         BIT  4,(HL)
  0E05    20 05                         JR   NZ,V24OU1    ;--> 7 Datenbit, ungerade Paritaet
  0E07    CB 6E                         BIT  5,(HL) 
  0E09    28 07                         JR   Z,V24OU2     ;--> 8 Datenbit, keine Paritaet
  0E0B    48                            LD   C,B          ;else --> 7 Datenbit, gerade Paritaet
  0E0C    A0                    V24OU1: AND  B 
  0E0D    EA 0E12                       JP   PE,V24OU2    ;Paritaet ist korrekt
  0E10    CB FF                         SET  7,A          ;else --> Paritaetsflag setzen
  0E12    A9                    V24OU2: XOR  C            ;Zeichen negieren ...
  0E13    4F                            LD   C,A          ;... und nach C kopieren
  0E14    7E                            LD   A,(HL) 
  0E15    E6 07                         AND  07H          ;Selektion der Baudrate
  0E17    47                            LD   B,A          ;B = Baudrate (kodiert)
  0E18    3E 01                         LD   A,01H 
  0E1A    87                    V24OU3: ADD  A,A 
  0E1B    10 FD                         DJNZ V24OU3 
  0E1D    57                            LD   D,A          ;19200 Baud --> D = 2
  0E1E    CB 76                         BIT  6,(HL) 
  0E20    20 06                         JR   NZ,V24OU5    ;kein Handshake
  0E22    DB 08                 V24OU4: IN   A,(P08)      ;else --> mit Handshake
  0E24    CB 57                         BIT  2,A 
  0E26    20 FA                         JR   NZ,V24OU4    ;warten auf fallende Flanke an A2
  0E28    06 0A                 V24OU5: LD   B,10         ;10 Durchlaeufe Bit-Ausgabe
  0E2A    CB 5E                         BIT  3,(HL)       ;Anzahl der Stopbits?
  0E2C    28 01                         JR   Z,V24OU6     ;1 Stopbit
  0E2E    04                            INC  B            ;2 Stopbits --> 11 Durchlaeufe
  0E2F    37                    V24OU6: SCF               ;Carry-Flag setzen (Startbit)
  0E30    5A                    V24OU7: LD   E,D          ;19200 Baud --> E = 2
  0E31    CB CF                         SET  1,A          ;TxD = High
  0E33    30 02                         JR   NC,V24OU8    ;Carry-Flag auswerten
  0E35    CB 8F                         RES  1,A          ;TxD = Low
  0E37    D3 08                 V24OU8: OUT  (P08),A      ;Ausgabe an A1 (TxD)
  0E39    6E                            LD   L,(HL)       ;Baudratenanpassung fuer 2 MHz
  0E3A    DD 23                         INC  IX           ;Baudratenanpassung fuer 2 MHz
  0E3C    1D                            DEC  E 
  0E3D    20 F8                         JR   NZ,V24OU8 
  0E3F    CB 39                         SRL  C            ;0 -> B7 ... B0 -> CY
  0E41    10 ED                         DJNZ V24OU7       ;naechstes Bit ausgeben
  0E43    F1                            POP  AF 
  0E44    C1                            POP  BC 
  0E45    D1                            POP  DE 
  0E46    E1                            POP  HL 
  0E47    C9                            RET 
                                ;
	MACRO-80 3.44	09-Dec-81	PAGE	1-48


                                ;
                                ; Funktion ":" --> Argument Anzeige (TODO)
                                ;
  0E48    00 09 3A 0D                   DEFB 00H,09H,3AH,0DH 
  0E4C    CD 04CA                       CALL ARGLD        ;ARG1-->HL ARG2-->DE ARG3-->BC
  0E4F    CD 07F1                       CALL L07F1
  0E52    DF                            RST  18H 
  0E53    A0                            DEFB 20H+80H 
  0E54    EB                            EX   DE,HL 
  0E55    CD 07F1                       CALL L07F1 
  0E58    60                            LD   H,B 
  0E59    69                            LD   L,C 
  0E5A    DF                            RST  18H 
  0E5B    A0                            DEFB 20H+80H 
  0E5C    CD 07F1                       CALL L07F1 
  0E5F    DF                            RST  18H 
  0E60    8D                            DEFB 0DH+80H 
  0E61    C9                            RET 
                                ;
                                ;
                                ; Funktion "p" --> RAM loeschen
                                ;
  0E62    00 09 70 0D                   DEFB 00H,09H,70H,0DH 
  0E66    21 1858                       LD   HL,1858H 
  0E69    36 FF                         LD   (HL),0FFH
  0E6B    11 1859                       LD   DE,1859H 
                                        IFDEF MONI88      ;Monitor 10/88 - Originalversion 1988
  0E6E    01 E7A7                       LD   BC,0E7A7H    ;loeschen bis 0FFFFH
                                        ENDIF
                                        IFDEF MONI88A     ;Monitor 10/88 - Originalversion mit Anpassungen
                                        LD   BC,0E6A7H    ;loeschen bis 0FEFFH
                                        ENDIF
                                        IFDEF MONI11      ;Monitor 10/88 - BWS-CPLD-Version 2011
                                        LD   BC,0E6A7H    ;loeschen bis 0FEFFH
                                        ENDIF
                                        IFDEF MONI11A     ;Monitor 10/88 - BWS-CPLD-Version mit Anpassungen
                                        LD   BC,0E6A7H    ;loeschen bis 0FEFFH
                                        ENDIF
  0E71    ED B0                         LDIR 
  0E73    DF                            RST  18H 
  0E74    20 43 6C 65                   DEFM " Clear RAM" 
  0E78    61 72 20 52           
  0E7C    41 4D                 
  0E7E    8D                            DEFB 0DH+80H 
  0E7F    C9                            RET
                                ;
                                ;
                                ; Funktion "U" --> Port lesen (TODO)
                                ;
  0E80    00 09 55 0D                   DEFB 00H,09H,55H,0DH;
  0E84    2A 185B                       LD   HL,(ARG1)
  0E87    4D                            LD   C,L          ;Portnummer in C
  0E88    ED 5B 181A                    LD   DE,(ZWINL)   ;Bildschirm-Adresse
  0E8C    13                            INC  DE 
  0E8D    CD 07F7                       CALL L07F7        ;CALL INHEX
  0E90    ED 53 1800            FKTU1:  LD   (KURPOS),DE  ;Kursor positionieren
  0E94    DF                            RST  18H 
  0E95    AA                            DEFB 2AH+80H      ;"*+80H 
  0E96    ED 78                         IN   A,(C) 
  0E98    CD 0183                       CALL OUTHEX       ;Wert ausgeben
	MACRO-80 3.44	09-Dec-81	PAGE	1-49


  0E9B    CD 07FA               FKTU2:  CALL L07FA        ;CALL TASTE
  0E9E    28 FB                         JR   Z,FKTU2      ;warten, bis Taste gedrueckt
  0EA0    FE D1                         CP   0D1H         ;"Q"?
  0EA2    C8                            RET  Z            ;ja --> Ende
  0EA3    18 EB                         JR   FKTU1 
                                ;
                                ;
                                ; ??? (TODO)
                                ;
  0EA5    ED A0                 L0EA5:  LDI 
  0EA7    1B                            DEC  DE 
  0EA8    1B                            DEC  DE 
  0EA9    EA 0EA5                       JP   PE,L0EA5 
  0EAC    C9                            RET 
                                ;
                                ;
                                ;
                                        IFDEF MONI88      ;Monitor 10/88 - Originalversion 1988
  0EAD                                  DEFS 7,0FFH       ;Platzhalter 7 Byte
                                        ENDIF
                                        IFDEF MONI88A     ;Monitor 10/88 - Originalversion mit Anpassungen
                                ;
                                ;
                                ; Funktion "X" --> AC1 ROM-Bank aufrufen (E000H bis FEFFH) - Teil 2
                                ;
                                PROGX3: OUT  (0C1H),A     ;HWT EPROM + LED
                                        OUT  (0C0H),A     ;NWT EPROM
                                        JP   0E000H       ;Programmstart Prog-X
                                ;
                                        ENDIF
                                        IFDEF MONI11      ;Monitor 10/88 - BWS-CPLD-Version 2011
                                ;
                                ; Funktion "8" --> PIO2-Karte: Bank 3 einschalten
                                ;
                                        DEFB 00H,09H,38H,0DH 
                                        JP   FKT8 
                                ;
                                        ENDIF
                                        IFDEF MONI11A     ;Monitor 10/88 - BWS-CPLD-Version mit Anpassungen
                                ;
                                ; Funktion "8" --> PIO2-Karte: Bank 3 einschalten
                                ;
                                        DEFB 00H,09H,38H,0DH 
                                        JP   FKT8 
                                ;
                                        ENDIF
                                ;
                                ;
                                ; UP 'Joy', Abfrage Joystick 1
                                ; ----------------------------
                                ;
  0EB4    C5                    UPJOY:  PUSH BC           ;Adresse 0EB4H
  0EB5    DB 05                         IN   A,(P05)      ;PIO1 Port B lesen
  0EB7    4F                            LD   C,A 
  0EB8    CB 8F                         RES  1,A          ;Joystick aktivieren
  0EBA    D3 05                         OUT  (P05),A      ;PIO1 Port B schreiben
  0EBC    DB 04                         IN   A,(P04)      ;PIO1 Port A lesen
  0EBE    47                            LD   B,A 
  0EBF    79                            LD   A,C          ;Joystick deaktivieren
  0EC0    D3 05                         OUT  (P05),A      ;PIO1 Port B schreiben
	MACRO-80 3.44	09-Dec-81	PAGE	1-50


  0EC2    78                            LD   A,B          ;Joystick-Wert in A
  0EC3    00                            NOP 
  0EC4    E6 1F                         AND  1FH          ;nur 5 Bit + Z-Flag setzen
  0EC6    C1                            POP  BC 
  0EC7    C9                            RET
                                ;
                                ;
                                ; Funktion "?" --> Help
                                ;
  0EC8    00 09 3F 0D                   DEFB 00H,09H,3FH,0DH 
  0ECC    DF                            RST  18H 
  0ECD    48 65 6C 70                   DEFM "Help:" 
  0ED1    3A                    
  0ED2    8D                            DEFB 0DH+80H 
  0ED3    21 0200                       LD   HL,0200H 
  0ED6    01 FE00                       LD   BC,0FE00H
  0ED9    AF                    L0ED9:  XOR  A 
  0EDA    ED B1                         CPIR 
  0EDC    E0                            RET  PO 
  0EDD    3E 09                         LD   A,09H 
  0EDF    BE                            CP   (HL) 
  0EE0    20 F7                         JR   NZ,L0ED9 
  0EE2    23                            INC  HL 
  0EE3    56                            LD   D,(HL) 
  0EE4    23                            INC  HL 
  0EE5    3E 0D                         LD   A,0DH 
  0EE7    BE                            CP   (HL) 
  0EE8    20 EF                         JR   NZ,L0ED9 
  0EEA    7A                            LD   A,D 
  0EEB    D7                            RST  10H          ;Ausgabe des Kennbuchstabens
  0EEC    DF                            RST  18H 
  0EED    20 20                         DEFM "  " 
  0EEF    A0                            DEFB 20H+80H 
  0EF0    18 E7                         JR   L0ED9 
                                ;
                                ;
                                ; weitere Bearb. fuer RST 10H   (Ausgabekanal, normal Bildschirm)
                                ; ---------------------------
                                ;
  0EF2    21 1820               RST10A: LD   HL,V24REG    ;V.24-Kontrollregister
  0EF5    CB 7E                         BIT  7,(HL)       ;V.24-Ausgabe mit 8 Bit?
  0EF7    20 02                         JR   NZ,RST10B    ;ja
  0EF9    E6 7F                         AND  7FH          ;nein --> 7. Bit ruecksetzen
  0EFB    23                    RST10B: INC  HL           ;HL --> I/O-Byte
  0EFC    FE 18                         CP   18H          ;Ctrl-X schaltet zusaetzlich V.24 ein
  0EFE    28 07                         JR   Z,RST10C 
  0F00    FE 19                         CP   19H          ;Ctrl-Y schaltet Ein/Ausgabe auf Standard
  0F02    20 07                         JR   NZ,RST10D 
  0F04    36 11                         LD   (HL),11H 
  0F06    21                            DEFB 21H          ;LD HL,0EECBH + nxt. Befehl ueberspringen!!!
  0F07    CB EE                 RST10C: SET 5,(HL)        ;Code = 0CBH, 0EEH
  0F09    18 14                         JR   RST10E 
                                ;
  0F0B    CB 66                 RST10D: BIT  4,(HL) 
  0F0D    C4 0033                       CALL NZ,FKT33     ;Funktion auf Adresse 0033H - Ausgabe ueber Bildschirm
  0F10    CB 6E                         BIT  5,(HL) 
  0F12    C4 0DF9                       CALL NZ,V24OUT    ;V.24 Ausgabe
  0F15    CB 76                         BIT  6,(HL) 
  0F17    C4 FFFF                       CALL NZ,0FFFFH 
  0F1A    CB 7E                         BIT  7,(HL) 
	MACRO-80 3.44	09-Dec-81	PAGE	1-51


  0F1C    C4 18F3                       CALL NZ,18F3H     ;Sprung zum UP User-Ausgabe
  0F1F    F1                    RST10E: POP  AF 
  0F20    E1                            POP  HL 
  0F21    C9                            RET 
                                ;
                                ;
                                ; Funktion "=" --> Bildschirminhalt ablegen (TODO)
                                ;
  0F22    00 09 3D 0D                   DEFB 00H,09H,3DH,0DH 
  0F26    DF                            RST  18H 
  0F27    0B 86                         DEFB 0BH,06H+80H 
  0F29    2A 1800                       LD   HL,(KURPOS) 
  0F2C    DF                            RST  18H 
  0F2D    0E                            DEFB 0EH 
  0F2E    30 30 35 39                   DEFM "0059" 
  0F32    AF                            DEFB 2FH+80H      ;"/+80H 
  0F33    CF                            RST  08H 
  0F34    D7                            RST  10H 
  0F35    22 1800                       LD   (KURPOS),HL 
  0F38    FE 38                         CP   38H 
  0F3A    D0                            RET  NC 
  0F3B    FE 30                         CP   30H 
  0F3D    D8                            RET  C 
  0F3E    D6 30                         SUB  30H 
  0F40    47                            LD   B,A 
  0F41    04                            INC  B 
  0F42    11 0800                       LD   DE,0800H 
  0F45    21 9FFF                       LD   HL,9FFFH 
  0F48    19                    L0F48:  ADD  HL,DE 
  0F49    10 FD                         DJNZ L0F48 
  0F4B    EB                            EX   DE,HL 
  0F4C    E5                            PUSH HL 
  0F4D    C1                            POP  BC 
  0F4E    21 1000                       LD   HL,1000H 
  0F51    C3 0EA5                       JP   L0EA5
                                ;
                                ;
                                ; Funktion "/" --> Bildschirmkopie zurueckschreiben (TODO)
                                ;
  0F54    00 09 2F 0D                   DEFB 00H,09H,2FH,0DH 
  0F58    21 9800                       LD   HL,9800H 
  0F5B    3A 185B                       LD   A,(ARG1) 
  0F5E    FE 08                         CP   08H 
  0F60    D0                            RET  NC 
  0F61    3C                            INC  A 
  0F62    11 0800                       LD   DE,0800H 
  0F65    47                            LD   B,A 
  0F66    19                    L0F66:  ADD  HL,DE 
  0F67    10 FD                         DJNZ L0F66 
  0F69    11 17FF               L0F69:  LD   DE,17FFH 
  0F6C    01 0800               L0F6C:  LD   BC,0800H 
  0F6F    E5                            PUSH HL 
  0F70    CD 0EA5                       CALL L0EA5 
  0F73    DF                            RST  18H 
  0F74    01 0B 91                      DEFB 01H,0BH,11H+80H 
  0F77    EB                            EX   DE,HL 
  0F78    E1                            POP  HL 
  0F79    CD 07F1                       CALL L07F1 
  0F7C    DF                            RST  18H 
  0F7D    AD                            DEFB 2DH+80H      ;"-+80H 
	MACRO-80 3.44	09-Dec-81	PAGE	1-52


  0F7E    EB                            EX   DE,HL 
  0F7F    2B                            DEC  HL 
  0F80    CD 07F1                       CALL L07F1 
  0F83    23                            INC  HL 
  0F84    DF                            RST  18H 
  0F85    90                            DEFB 10H+80H 
  0F86    CF                            RST  08H 
  0F87    FE 0B                         CP   0BH 
  0F89    28 DE                         JR   Z,L0F69 
  0F8B    FE 0A                         CP   0AH 
  0F8D    C0                            RET  NZ 
  0F8E    01 F000                       LD   BC,0F000H
  0F91    09                            ADD  HL,BC 
  0F92    18 D5                         JR   L0F69 
                                ;
                                        IFDEF MONI88      ;Monitor 10/88 - Originalversion 1988
                                ;
                                ;
                                ; ??? (TODO)
                                ;
  0F94    18 D6                 L0F94:  JR   L0F6C
                                ;
                                ;
                                ; ??? (TODO)
                                ;
  0F96    CD 04CA               L0F96:  CALL ARGLD        ;ARG1-->HL ARG2-->DE ARG3-->BC
  0F99    EB                            EX   DE,HL
  0F9A    23                            INC  HL
  0F9B    AF                            XOR  A
  0F9C    ED 52                         SBC  HL,DE
  0F9E    01 FFFF                       LD   BC,0FFFFH
  0FA1    1A                    L0FA1:  LD   A,(DE)
  0FA2    A8                            XOR  B
  0FA3    47                            LD   B,A
  0FA4    0F                            RRCA
  0FA5    0F                            RRCA
  0FA6    0F                            RRCA
  0FA7    0F                            RRCA
  0FA8    E6 0F                         AND  0FH
  0FAA    A8                            XOR  B
  0FAB    47                            LD   B,A
  0FAC    0F                            RRCA
  0FAD    0F                            RRCA
  0FAE    0F                            RRCA
  0FAF    F5                            PUSH AF
  0FB0    E6 1F                         AND  1FH
  0FB2    A9                            XOR  C
  0FB3    4F                            LD   C,A
  0FB4    F1                            POP  AF
  0FB5    F5                            PUSH AF
  0FB6    0F                            RRCA
  0FB7    E6 F0                         AND  0F0H
  0FB9    A9                            XOR  C
  0FBA    4F                            LD   C,A
  0FBB    F1                            POP  AF
  0FBC    E6 E0                         AND  0E0H
  0FBE    A8                            XOR  B
  0FBF    41                            LD   B,C
  0FC0    4F                            LD   C,A
  0FC1    13                            INC  DE
	MACRO-80 3.44	09-Dec-81	PAGE	1-53


  0FC2    2B                            DEC  HL
  0FC3    7C                            LD   A,H
  0FC4    B5                            OR   L
  0FC5    20 DA                         JR   NZ,L0FA1
  0FC7    C5                            PUSH BC
  0FC8    DF                            RST  18H
  0FC9    20 43 52 43                   DEFM " CRC"
  0FCD    A0                            DEFB 20H+80H
  0FCE    E1                            POP  HL
  0FCF    C3 019A                       JP   OUTHL
                                ;
  0FD2                                  DEFS 8,0FFH       ;Platzhalter 8 Byte
                                ;
                                ; Funktion "r" --> Basic-Warmstart
                                ;
  0FDA    00 09 72 0D                   DEFB 00H,09H,72H,0DH 
  0FDE    3E 02                         LD   A,02H
  0FE0    D3 14                         OUT  (P14),A      ;Modul 1: EPROM mit Basic
  0FE2    C3 5FD5                       JP   5FD5H        ;Sprung ins Basic-Programm
                                ;
                                ;
                                ; Funktion "X" --> Programmpaket X
                                ;
  0FE5    00 09 58 0D                   DEFB 00H,09H,58H,0DH 
  0FE9    C3 006B                       JP   JUMPX
                                ;
                                ;
                                ; Funktion "b" --> Basic-Kaltstart
                                ;
  0FEC    09 62 0D                      DEFB 09H,62H,0DH  ;die 00H wird vom letzten Befehl genutzt
  0FEF    3E 02                         LD   A,02H
  0FF1    D3 14                         OUT  (P14),A      ;Modul 1: EPROM mit Basic
  0FF3    C3 5FCC                       JP   5FCCH        ;Sprung ins Basic-Programm
                                ;
                                        ENDIF             ;Monitor 10/88 - Originalversion 1988
                                        IFDEF MONI88A     ;Monitor 10/88 - Originalversion mit Anpassungen
                                ;
                                ;
                                ; ??? (TODO)
                                ;
                                L0F94:  JR   L0F6C
                                ;
                                ;
                                ; ??? (TODO)
                                ;
                                L0F96:  CALL ARGLD        ;ARG1-->HL ARG2-->DE ARG3-->BC
                                        EX   DE,HL
                                        INC  HL
                                        XOR  A
                                        SBC  HL,DE
                                        LD   BC,0FFFFH
                                L0FA1:  LD   A,(DE)
                                        XOR  B
                                        LD   B,A
                                        RRCA
                                        RRCA
                                        RRCA
                                        RRCA
                                        AND  0FH
                                        XOR  B
	MACRO-80 3.44	09-Dec-81	PAGE	1-54


                                        LD   B,A
                                        RRCA
                                        RRCA
                                        RRCA
                                        PUSH AF
                                        AND  1FH
                                        XOR  C
                                        LD   C,A
                                        POP  AF
                                        PUSH AF
                                        RRCA
                                        AND  0F0H
                                        XOR  C
                                        LD   C,A
                                        POP  AF
                                        AND  0E0H
                                        XOR  B
                                        LD   B,C
                                        LD   C,A
                                        INC  DE
                                        DEC  HL
                                        LD   A,H
                                        OR   L
                                        JR   NZ,L0FA1
                                        PUSH BC
                                        RST  18H
                                        DEFM " CRC"
                                        DEFB 20H+80H
                                        POP  HL
                                        JP   OUTHL
                                ;
                                        DEFB 0FFH         ;Platzhalter 1 Byte
                                ;
                                ;
                                ; Funktion "X" --> AC1 ROM-Bank aufrufen (E000H bis FEFFH) - Teil 1
                                ;
                                        DEFB 00H,09H,58H,0DH 
                                PROGX1: LD   DE,8000H     ;Pointer auf EPROM + LED
                                        LD   HL,0E000H    ;Pointer auf Hauptspeicher
                                        LD   BC,1F00H     ;Laenge (E000H - FEFFH)
                                        XOR  A            ;XWT EPROM
                                        OUT  (0C6H),A
                                PROGX2: LD   A,D          ;HWT EPROM
                                        OUT  (0C1H),A
                                        LD   A,E          ;NWT EPROM
                                        OUT  (0C0H),A
                                        INC  DE
                                        IN   A,(0C2H)     ;Data
                                        LD   (HL),A
                                        INC  HL
                                        DEC  BC
                                        LD   A,B
                                        OR   C
                                        JR   NZ,PROGX2
                                        JP   PROGX3       ;zum Teil 2 der Funktion
                                ;
                                        ENDIF             ;Monitor 10/88 - Originalversion mit Anpassungen
                                        IFDEF MONI11      ;Monitor 10/88 - BWS-CPLD-Version 2011
                                ;
                                ; Funktion "!" --> Farbbyte einstellen
	MACRO-80 3.44	09-Dec-81	PAGE	1-55


                                ;
                                        DEFB 00H,09H,21H,0DH
                                        LD   A,(ARG1) 
                                        OR   A            ;wenn ARG1=0 ist --> Vorgabewert nehmen
                                        JR   NZ,FINIT1 
                                ;
                                ;
                                ; Farb-Initialisierung des CPLD
                                ;
                                FINIT:  LD   A,02H        ;Farbbyte: nach Reset = 02H
                                FINIT1: PUSH AF 
                                        XOR  A            ;Wert fuer Monochrom-BWS
                                        LD   (COLOR),A    ;Merkzelle fuer Farbbyte im RAM schreiben
                                        POP  AF 
                                        LD   C,PF0        ;I/O-Adresse COLOR-BWS
                                        IN   B,(C)        ;Konfigbyte COLOR-BWS lesen
                                        INC  B            ;fuer COLOR-BWS ist B!=0
                                        RET  Z            ;kein COLOR-BWS vorhanden --> Ende
                                        DEC  B 
                                        LD   D,B 
                                        SET  2,D          ;Konfigbyte COLOR-BWS: Farb-RAM aktiv
                                        LD   HL,1000H 
                                        LD   E,(HL) 
                                        OUT  (C),D        ;COLOR-BWS auf Farb-RAM umschalten
                                        LD   (HL),A       ;Farbe auf 1000h setzen
                                        CP   (HL)         ;ist ein Farb-RAM eingebaut?
                                        OUT  (C),B        ;Konfigbyte COLOR-BWS: Text-RAM aktiv
                                        LD   (HL),E       ;Zeichen auf 1000h zurueckschreiben
                                        RET  NZ           ;Farbe hat nicht geklappt --> Ende
                                        OUT  (C),D        ;nochmal COLOR-BWS auf Farb-RAM umschalten
                                        PUSH BC 
                                        LD   DE,1001H 
                                        LD   BC,07FFH 
                                        LDIR              ;Farbe in den restlichen BWS-RAM schreiben
                                        LD   A,(HL)       ;Farbe aus 17FEh ruecklesen
                                        POP  BC 
                                        OUT  (C),B        ;Konfigbyte COLOR-BWS: Text-RAM aktiv
                                        LD   (COLOR),A    ;Merkzelle fuer Farbbyte im RAM schreiben
                                        RET 
                                ;
                                ;
                                ; Funktion "7" --> PIO2-Karte: Bank 2 einschalten
                                ;
                                        DEFB 00H,09H,37H,0DH 
                                        LD   A,20H        ;ehemals 10H, war falsch!!
                                        OUT  (P0F),A 
                                        JP   2000H        ;Programmstart von UserProg auf 2000H
                                ;
                                ;
                                ; Funktion "r" --> Basic-Warmstart
                                ;
                                        DEFB 00H,09H,72H,0DH 
                                        LD   A,02H
                                        OUT  (P14),A      ;Modul 1: EPROM mit Basic
                                        JP   5FD5H        ;Sprung ins Basic-Programm
                                ;
                                ;
                                ; Funktion "X" --> Programmpaket X
                                ;
                                        DEFB 00H,09H,58H,0DH 
	MACRO-80 3.44	09-Dec-81	PAGE	1-56


                                        JP   JUMPX
                                ;
                                ;
                                ; Funktion "b" --> Basic-Kaltstart
                                ;
                                        DEFB 09H,62H,0DH  ;die 00H wird vom letzten Befehl genutzt
                                        LD   A,02H
                                        OUT  (P14),A      ;Modul 1: EPROM mit Basic
                                        JP   5FCCH        ;Sprung ins Basic-Programm
                                ;
                                        ENDIF             ;Monitor 10/88 - BWS-CPLD-Version 2011
                                        IFDEF MONI11A     ;Monitor 10/88 - BWS-CPLD-Version mit Anpassungen
                                ;
                                ; Funktion "!" --> Farbbyte einstellen
                                ;
                                        DEFB 00H,09H,21H,0DH
                                        LD   A,(ARG1) 
                                        OR   A            ;wenn ARG1=0 ist --> Vorgabewert nehmen
                                        JR   NZ,FINIT1 
                                ;
                                ;
                                ; Farb-Initialisierung des CPLD
                                ;
                                FINIT:  LD   A,4FH        ;Farbbyte: nach Reset = 4FH
                                FINIT1: PUSH AF 
                                        XOR  A            ;Wert fuer Monochrom-BWS
                                        LD   (COLOR),A    ;Merkzelle fuer Farbbyte im RAM schreiben
                                        POP  AF 
                                        LD   C,PF0        ;I/O-Adresse COLOR-BWS
                                        IN   B,(C)        ;Konfigbyte COLOR-BWS lesen
                                        INC  B            ;fuer COLOR-BWS ist B!=0
                                        RET  Z            ;kein COLOR-BWS vorhanden --> Ende
                                        DEC  B 
                                        LD   D,B 
                                        SET  2,D          ;Konfigbyte COLOR-BWS: Farb-RAM aktiv
                                        LD   HL,1000H 
                                        LD   E,(HL) 
                                        OUT  (C),D        ;COLOR-BWS auf Farb-RAM umschalten
                                        LD   (HL),A       ;Farbe auf 1000h setzen
                                        CP   (HL)         ;ist ein Farb-RAM eingebaut?
                                        OUT  (C),B        ;Konfigbyte COLOR-BWS: Text-RAM aktiv
                                        LD   (HL),E       ;Zeichen auf 1000h zurueckschreiben
                                        RET  NZ           ;Farbe hat nicht geklappt --> Ende
                                        OUT  (C),D        ;nochmal COLOR-BWS auf Farb-RAM umschalten
                                        PUSH BC 
                                        LD   DE,1001H 
                                        LD   BC,07FFH 
                                        LDIR              ;Farbe in den restlichen BWS-RAM schreiben
                                        LD   A,(HL)       ;Farbe aus 17FEh ruecklesen
                                        POP  BC 
                                        OUT  (C),B        ;Konfigbyte COLOR-BWS: Text-RAM aktiv
                                        LD   (COLOR),A    ;Merkzelle fuer Farbbyte im RAM schreiben
                                        RET 
                                ;
                                ;
                                ; Funktion "7" --> PIO2-Karte: Bank 2 einschalten
                                ;
                                        DEFB 00H,09H,37H,0DH 
                                        LD   A,20H        ;ehemals 10H, war falsch!! 
                                        OUT  (P0F),A 
	MACRO-80 3.44	09-Dec-81	PAGE	1-57


                                        JP   2000H        ;Programmstart von UserProg auf 2000H
                                ;
                                ;
                                ; Funktion "X" --> AC1-2010 ROM-Bank aufrufen (1900H bis 1FFFH)
                                ;
                                        DEFB 00H,09H,58H,0DH 
                                PROGX4: LD   A,0F6H
                                        OUT  (P0E),A 
                                        LD   DE,1900H 
                                        LD   HL,0A000H
                                        LD   BC,0700H 
                                        LDIR 
                                        LD   A,00H 
                                        OUT  (P0E),A 
                                        JP   1900H        ;Programmstart ROM-Bank
                                ;
                                        DEFS 2,0FFH       ;Platzhalter 2 Byte
                                ;
                                        ENDIF             ;Monitor 10/88 - BWS-CPLD-Version mit Anpassungen
                                ;
                                ;
                                ; Funktion "<SPACE>" --> nix tun...
                                ;
  0FF6    00 09 20 0D                   DEFB 00H,09H,20H,0DH 
  0FFA    C9                            RET 
                                ;
                                ;
                                ; Funktion "<ENTER>" --> nix tun...
                                ;
  0FFB    00 09 0D 0D                   DEFB 00H,09H,0DH,0DH 
  0FFF    C9                            RET
                                ;
                                ;
                                        .DEPHASE
                                        END
	MACRO-80 3.44	09-Dec-81	PAGE	S


Macros:

Symbols:
185B 	ARG1            185D 	ARG2            185F 	ARG3            
04CA 	ARGLD           0240 	BREAK           0327 	BS0327          
0365 	BS0365          036B 	BS036B          0375 	BS0375          
0381 	BS0381          0387 	BS0387          038C 	BS038C          
038F 	BS038F          0395 	BS0395          039A 	BS039A          
03A0 	BS03A0          03A3 	BS03A3          03A8 	BS03A8          
03B8 	BS03B8          03C7 	BS03C7          03D7 	BS03D7          
0328 	BSEND1          032B 	BSEND2          032E 	BSEND3          
037F 	CLREND          0377 	CLRLIN          181F 	COLOR           
069C 	COMP1           06BF 	COMP2           01A5 	CPURSA          
03AB 	DELE1           03B3 	DELE2           035D 	DELETE          
0728 	EINZ1           00A2 	ENDE8           0268 	ERROR           
0033 	FKT33           002B 	FKT33A          0300 	FKT33B          
0318 	FKT33C          031B 	FKT33D          0E90 	FKTU1           
0E9B 	FKTU2           025B 	GETCO           1857 	HREGIN          
0172 	INHEX           067E 	INHEX4          0AA8 	INIRSA          
000B 	INIT1           001B 	INIT2           003B 	INIT3           
0044 	INIT4           004D 	INIT5           0069 	INIT6           
006E 	INIT7           012F 	INLIN1          013A 	INLIN2          
0128 	INLINE          03C0 	INSE1           1821 	IOBYTE          
04E9 	JPLDIR          06FA 	JUMP1           0700 	JUMP2           
070E 	JUMP3           006B 	JUMPX           01DB 	KOMM0           
01DE 	KOMM1           01E7 	KOMM2           021F 	KOMM3           
0354 	KUPOS1          0355 	KUPOS2          0333 	KUPOSI          
0392 	KURMOV          1800 	KURPOS          007F 	KURSOR          
0000 	L0000           0008 	L0008           0010 	L0010           
0018 	L0018           0020 	L0020           0028 	L0028           
0030 	L0030           0288 	L0288           0290 	L0290           
0404 	L0404           0410 	L0410           0441 	L0441           
0443 	L0443           044E 	L044E           045E 	L045E           
0471 	L0471           047A 	L047A           0487 	L0487           
0492 	L0492           0494 	L0494           0496 	L0496           
04A4 	L04A4           04A8 	L04A8           04AD 	L04AD           
04B5 	L04B5           051D 	L051D           0525 	L0525           
052F 	L052F           0552 	L0552           0565 	L0565           
0579 	L0579           057F 	L057F           0585 	L0585           
05CE 	L05CE           05E3 	L05E3           05F3 	L05F3           
05F9 	L05F9           0603 	L0603           063D 	L063D           
064C 	L064C           0659 	L0659           0665 	L0665           
0672 	L0672           0673 	L0673           06CE 	L06CE           
072B 	L072B           0775 	L0775           077E 	L077E           
0785 	L0785           078D 	L078D           0797 	L0797           
07C2 	L07C2           07CF 	L07CF           07D0 	L07D0           
07E8 	L07E8           07EB 	L07EB           07EE 	L07EE           
07F1 	L07F1           07F4 	L07F4           07F7 	L07F7           
07FA 	L07FA           07FD 	L07FD           0800 	L0800           
0804 	L0804           0807 	L0807           0823 	L0823           
0846 	L0846           0867 	L0867           0870 	L0870           
0873 	L0873           088E 	L088E           0894 	L0894           
0899 	L0899           08A6 	L08A6           08D7 	L08D7           
08DE 	L08DE           08E3 	L08E3           08EB 	L08EB           
08F3 	L08F3           08F9 	L08F9           0903 	L0903           
090B 	L090B           0912 	L0912           091B 	L091B           
0924 	L0924           0929 	L0929           092C 	L092C           
0932 	L0932           0938 	L0938           0957 	L0957           
096D 	L096D           097D 	L097D           098E 	L098E           
	MACRO-80 3.44	09-Dec-81	PAGE	S-1


0999 	L0999           09A2 	L09A2           09AD 	L09AD           
09B3 	L09B3           09C4 	L09C4           09C5 	L09C5           
09DB 	L09DB           09DE 	L09DE           09EB 	L09EB           
09F6 	L09F6           09FC 	L09FC           0A06 	L0A06           
0A0F 	L0A0F           0A2B 	L0A2B           0A31 	L0A31           
0A37 	L0A37           0A3C 	L0A3C           0A5B 	L0A5B           
0A61 	L0A61           0A6A 	L0A6A           0A7B 	L0A7B           
0A80 	L0A80           0B33 	L0B33           0B43 	L0B43           
0B46 	L0B46           0B51 	L0B51           0B5B 	L0B5B           
0B63 	L0B63           0B76 	L0B76           0B85 	L0B85           
0B97 	L0B97           0BA5 	L0BA5           0BB3 	L0BB3           
0BBA 	L0BBA           0BC3 	L0BC3           0BCF 	L0BCF           
0BD4 	L0BD4           0BE1 	L0BE1           0BE6 	L0BE6           
0BED 	L0BED           0BF7 	L0BF7           0BFD 	L0BFD           
0C0B 	L0C0B           0C10 	L0C10           0C13 	L0C13           
0C15 	L0C15           0C21 	L0C21           0C23 	L0C23           
0C33 	L0C33           0C3A 	L0C3A           0C3E 	L0C3E           
0C4E 	L0C4E           0C52 	L0C52           0C57 	L0C57           
0C59 	L0C59           0C5B 	L0C5B           0C63 	L0C63           
0C68 	L0C68           0C6B 	L0C6B           0C6D 	L0C6D           
0C76 	L0C76           0C7A 	L0C7A           0C81 	L0C81           
0C8D 	L0C8D           0C99 	L0C99           0CAC 	L0CAC           
0CBD 	L0CBD           0CC5 	L0CC5           0CCA 	L0CCA           
0CD0 	L0CD0           0CDB 	L0CDB           0CE7 	L0CE7           
0CEC 	L0CEC           0CF9 	L0CF9           0D06 	L0D06           
0D09 	L0D09           0D23 	L0D23           0D2D 	L0D2D           
0D32 	L0D32           0D34 	L0D34           0D38 	L0D38           
0D3B 	L0D3B           0D52 	L0D52           0D5A 	L0D5A           
0D64 	L0D64           0D67 	L0D67           0D6F 	L0D6F           
0D70 	L0D70           0D7C 	L0D7C           0D81 	L0D81           
0D83 	L0D83           0D86 	L0D86           0D8E 	L0D8E           
0DAD 	L0DAD           0DC9 	L0DC9           0DE1 	L0DE1           
0DF0 	L0DF0           0EA5 	L0EA5           0ED9 	L0ED9           
0F48 	L0F48           0F66 	L0F66           0F69 	L0F69           
0F6C 	L0F6C           0F94 	L0F94           0F96 	L0F96           
0FA1 	L0FA1           0001 	MONI88          011D 	MS30            
0121 	MS30A           00D6 	NOTAST          010C 	NOV24           
0183 	OUTHEX          019A 	OUTHL           0589 	OUTHL1          
058C 	OUTHL2          0ACA 	OUTHL3          018C 	OUTHX1          
0197 	OUTHX2          0000 	P00             0004 	P04             
0005 	P05             0008 	P08             000E 	P0E             
000F 	P0F             0014 	P14             0016 	P16             
00F0 	PF0             009B 	PIEP            0116 	PROGX           
01D1 	RSACP1          01BC 	RSACPU          00A5 	RST08           
00B3 	RST08A          00BD 	RST08B          00C1 	RST08C          
00C3 	RST08D          00CA 	RST08E          0013 	RST10           
0EF2 	RST10A          0EFB 	RST10B          0F07 	RST10C          
0F0B 	RST10D          0F1F 	RST10E          0A8D 	RST18           
0A8F 	RST18A          0743 	RUNBP           03E3 	SCROL1          
03F6 	SCROL2          03DC 	SCROLL          0220 	SPTAB           
0AD8 	TABIO           1822 	TASCOD          0D4D 	TASTE           
0275 	TUELU1          0272 	TUELUE          0156 	UPINH1          
0168 	UPINH2          0146 	UPINHX          0EB4 	UPJOY           
0ACE 	UPRAMT          02A0 	UPTAS1          02BB 	UPTAS2          
02BD 	UPTAS3          02C3 	UPTAS4          02C5 	UPTAS5          
0297 	UPTAST          0287 	UPTON           01D6 	V24IN           
00D9 	V24IN1          00E1 	V24IN2          00E8 	V24IN3          
00EF 	V24IN4          00F6 	V24IN5          00F9 	V24IN6          
0E0C 	V24OU1          0E12 	V24OU2          0E1A 	V24OU3          
0E22 	V24OU4          0E28 	V24OU5          0E2F 	V24OU6          
	MACRO-80 3.44	09-Dec-81	PAGE	S-2


0E30 	V24OU7          0E37 	V24OU8          0DF9 	V24OUT          
1820 	V24REG          02F0 	ZGUMS           181A 	ZWINL           



No Fatal error(s)


